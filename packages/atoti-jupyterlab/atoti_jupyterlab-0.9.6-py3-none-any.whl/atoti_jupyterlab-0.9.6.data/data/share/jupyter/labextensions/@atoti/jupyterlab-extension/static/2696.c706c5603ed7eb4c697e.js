/*! For license information please see 2696.c706c5603ed7eb4c697e.js.LICENSE.txt */
(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[2696,4389,6770,9151,5723],{92696:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>un});var i=n(3161),s=n(89594),r=n(76228),o=n(92338),a=n(72871),l=n(47216),d=n(74602),c=n(94692),u=n(36212);const g=[u.toolContentEditor,u.toolFiltersEditor,u.toolStyleEditor].map((e=>{const{shortcut:t,...n}=e;return n})),h="en-US",p={default:"en-US"},m=e=>{if(!e)return h;const t=e.get("locale").composite,n=p[t];return void 0===n?(console.error(`Atoti does not support JupyterLab's ${t} locale, falling back to ${h}.`),h):n},y=async(e,{pluginRegistry:t})=>{const[i,{default:s}]=await Promise.all([(0,u.fetchTranslations)(e),n(20625)(`./${e}.js`)]);return{...i,...(0,u.getPluginsTranslations)(t,e),...(0,u.getToolsTranslations)([...g],e),...(0,c.treeToFlatMap)(s)}};class C{static async create({pluginRegistry:e,settingRegistry:t}){const n=await t.load("@jupyterlab/translation-extension:plugin"),i=m(n),s=await y(i,{pluginRegistry:e});return new C({initialConfig:{locale:i,messages:s},pluginRegistry:e,translationSettings:n})}_changed=new d.Signal(this);_config;constructor({initialConfig:e,pluginRegistry:t,translationSettings:n}){this._config=e,n.changed.connect((async()=>{const e=m(n),i=await y(e,{pluginRegistry:t});this._config={locale:e,messages:i},this._changed.emit()}))}get changed(){return this._changed}get config(){return this._config}}const f=async e=>{e.theme||(await new Promise((t=>{const n=()=>{e.themeChanged.disconnect(n),t(void 0)};e.themeChanged.connect(n)})),await f(e))};class w{static async create(e){await f(e);const t=()=>!e.theme||e.isLight(e.theme)?u.lightActiveViamTheme:u.darkActiveViamTheme,n=t();return new w({initialTheme:n,syncTheme:t,themeManager:e})}_changed=new d.Signal(this);_theme;constructor({initialTheme:e,syncTheme:t,themeManager:n}){this._theme=e,n.themeChanged.connect((()=>{this._theme=t(),this._changed.emit()}))}get changed(){return this._changed}get theme(){return this._theme}}var v=n(87315),b=n(29012);class S{listeners=new Set;async run(){await Promise.all([...this.listeners].map((async e=>{await e()})))}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}}var k=n(74389),T=n(58997),M=n(38412),x=n(93345),I=n(56155),D=n(5140),Y=n(7628),P=n(50892),E=n(58597);const W="Content-Type",_="application/json",$=(e,{requestInit:t={}}={})=>async(n,{body:i,contentType:s=_,method:r,signal:o}={})=>{const a=`${e}${n.startsWith("/")?n:`/${n}`}`,l=await fetch(a,{...t,body:i,headers:{...t.headers,...s?{[W]:s}:void 0},method:r,signal:o});if(!l.ok){const e=await l.json();throw console.error(e),new Error(`Unexpected response status: ${l.status}`)}const d=l.headers.get(W)===_;let c=await(d?l.json():l.text());return d&&"object"==typeof c&&"success"===c.status&&"data"in c&&(c=c.data),c},R=E.PageConfig.getBaseUrl(),j=E.URLExt.join(R,"proxy"),L=async(e,{jupyterServerProxyEnabled:t,signal:n})=>{const{hostname:i,pathname:s,port:r,protocol:o}=new URL(e),a=r||("https:"===o?"443":"80"),l=[];if(t){const e=s&&"/"!==s?[s]:[];l.push(E.URLExt.join(j,["localhost","127.0.0.1","0.0.0.0"].includes(i)?a:`${i}:${a}`,...e))}l.push(e);const{hostname:d,protocol:c}=window.location,u=d.split(".");u.length>2&&l.push(`${c}//${[`${u[0]}-${a}`,...u.slice(1)].join(".")}`);for(const e of l)try{const t=$(e);return{sessionUrl:e,versions:await t("versions/rest",{signal:n})}}catch{}throw new Error("Cannot access the session after trying "+(1===l.length?`this URL: ${l[0]}`:`these URLs: ${l.join(", ")}`))},F=e=>e.apis.atoti?.versions[0],U=(e,t="")=>{if(""===t){const{pathname:t}=new URL(e);return`${e}${""===t||"/"===t?"":"/"}`}return`${e}/${t}`};var A=n(31529);class O{static async create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionUrl:i,signal:s}){const{sessionUrl:r,versions:o}=await L(i,{jupyterServerProxyEnabled:e,signal:s}),a=null===t?void 0:{credentials:"include",headers:t,mode:"cors"},l=$(r,{requestInit:a}),[d,c,g]=["content","jwt","pivot"].map((e=>{const t=[`activeviam/${e}`,e];for(const e of t)if(e in o.apis)return o.apis[e].versions[0]}));if(!c)throw new Error(`Missing \`jwt\` service in ${Object.keys(o.apis)}.`);if(!g)throw new Error(`Missing \`pivot\` service in ${Object.keys(o.apis)}.`);const h=(0,u.createAtotiClient)({requestInit:a,serverVersion:o.serverVersion,serviceVersion:g,url:r}),p=(e=>{const t=e?.Authorization||e?.authorization;return"string"==typeof t&&t.startsWith("Jwt ")?t:void 0})(t),[{token:m}]=await Promise.all([p?Promise.resolve({token:p}):l(`${c.restPath}/token`),h.loadDataModel({signal:s})]),y=(0,u.getUserFromJwt)(m),C=d?(0,u.createContentClient)({requestInit:a,serverVersion:o.serverVersion,serviceVersion:d,url:r}):void 0;return new O({atotiClient:h,contentClient:C,fetch:l,id:n,user:y,versions:o})}atotiClient;contentClient;fetch;id;user;versions;_disposed=new d.Signal(this);_isDisposed=!1;subscriberCount=0;stopSyncingDataModel;constructor({atotiClient:e,contentClient:t,fetch:n,id:i,user:s,versions:r}){this.atotiClient=e,this.contentClient=t,this.fetch=n,this.id=i,this.stopSyncingDataModel=F(r)?(0,l.syncDataModel)(e):A.noop,this.user=s,this.versions=r}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),this.atotiClient.disconnect(),this.stopSyncingDataModel(),d.Signal.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}subscribe(){return this.subscriberCount++,()=>{this.subscriberCount--,0===this.subscriberCount&&this.dispose()}}}const B=({children:e,description:t,icon:n,id:i})=>{const{formatMessage:s}=(0,P.useIntl)();return(0,k.Y)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:(0,k.Y)(M.Empty,{description:(0,k.FD)("span",{css:{color:"var(--jp-ui-font-color1)"},children:[(0,k.Y)("span",{css:{fontSize:"var(--jp-ui-font-size2)"},children:s({id:`${i}.title`})}),(0,k.Y)("br",{}),(0,k.Y)("span",{css:{color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size1)"},children:t??s({id:`${i}.description`})})]}),image:n,imageStyle:{fontSize:42,height:60},children:e})})};var N=n(77051);const K=({hasSnapshot:e})=>e?(0,k.Y)(B,{icon:(0,k.Y)(N.CameraOutlined,{}),id:"widget.snapshotSelected"}):(0,k.Y)(B,{icon:(0,k.Y)(N.ApiOutlined,{}),id:"widget.waitingForConnection"}),z=(e,t)=>{const n=(0,x.useCallback)((t=>e?(e.connect(t),()=>{e.disconnect(t)}):A.noop),[e]);return(0,x.useSyncExternalStore)(n,t)},H=(e,{property:t,sender:n})=>z(e,(()=>{if(n)return n[t]})),q=(0,x.createContext)(void 0),V=()=>{const e=(0,x.useContext)(q);if(!e)throw new Error("Missing session clients.");return e},Q=(0,x.createContext)(void 0),J=({children:e,sessionId:t})=>{const n=V(),i=z(n.changed,(()=>n.get(t))),s=(0,x.useMemo)((()=>{const e={};return i&&(e[l.defaultServerKey]=i.atotiClient),e}),[i]);return i?(0,k.Y)(u.UserProvider,{value:i.user,children:(0,k.Y)(u.ClientsProvider,{value:{atoti:s},children:(0,k.Y)(Q.Provider,{value:i,children:e})})}):(0,k.Y)(K,{})},G=()=>{const e=(0,x.useContext)(Q);if(!e)throw new Error("Missing session client.");return e};class X{_changed=new d.Signal(this);sessionClients={};sessionClientCreations={};get changed(){return this._changed}get(e){return this.sessionClients[e]}async getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionUrl:i,signal:s}){const r=this.get(n);if(r){const{atotiClient:e}=r;return"disconnected"===e.connectionStatus&&await e.connect(),r}n in this.sessionClientCreations||(this.sessionClientCreations[n]=(async()=>{const r=await O.create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionUrl:i,signal:s}),o=()=>{Reflect.deleteProperty(this.sessionClients,n),this._changed.emit(),r.disposed.disconnect(o)};r.disposed.connect(o),this.sessionClients[n]=r,Reflect.deleteProperty(this.sessionClientCreations,n),this._changed.emit()})()),await this.sessionClientCreations[n];const o=this.sessionClients[n];if(!o)throw new Error("Missing session client.");return o}}const Z=e=>"mapping"in e;var ee=n(92377),te=n(90147);class ne{onChange;index=0;states;constructor(e,t){this.onChange=t,this.states=[e]}get current(){return this.states[this.index]}get canRedo(){return this.index<this.states.length-1}get canUndo(){return this.index>0}set(e){e!==this.current&&(this.index++,this.states.length=this.index,this.states.push(e),this.onChange())}redo(){if(!this.canRedo)throw new Error("Cannot redo");this.index++,this.onChange()}undo(){if(!this.canUndo)throw new Error("Cannot undo");this.index--,this.onChange()}}const ie="atoti",se="height",re="widget",oe=360,ae=e=>e.getMetadata(ie)??void 0,le=e=>{const t=e[re];return{...e,[re]:t?(0,u.deserializeWidgetState)(t):void 0}},de=e=>{const t=e[re];return{...e,[re]:t?(0,u.serializeWidgetState)(t):void 0}},ce=e=>ae(e)?.[se]??oe;class ue{cellModel;_changed=new d.Signal(this);_isDeferredChanged=new d.Signal(this);_isDeferred=!1;_isDisposed=!1;disconnectFromCellMetadataChangedSignal;undoableState;updatingState=!1;widgetPlugins;constructor(e,{widgetPlugins:t}){this.cellModel=e;const n=ae(this.cellModel);this.undoableState=new ne(n?le(n):void 0,(()=>{this.updatingState=!0;try{this.current?this.cellModel.setMetadata(ie,de(this.current)):this.cellModel.deleteMetadata(ie)}finally{this.updatingState=!1}this._changed.emit()}));const i=(e,{key:t,newValue:n})=>{t!==ie||this.updatingState||(this.current=((e,t)=>{if(!t)return;const n=le(t);return e?(i=e,s=n,(0,te.produce)(i,(e=>{const t=(0,ee.compare)(e,s);(0,ee.applyPatch)(e,t)}))):n;var i,s})(this.current,n))};this.cellModel.metadataChanged.connect(i),this.disconnectFromCellMetadataChangedSignal=()=>{this.cellModel.metadataChanged.disconnect(i)},this.widgetPlugins=t}get defaultWidgetState(){return this.widgetPlugins[0].initialState}get canRedo(){return this.undoableState.canRedo}get canUndo(){return this.undoableState.canUndo}get changed(){return this._changed}get current(){return this.undoableState.current}set current(e){this.undoableState.set(e)}dispose(){this.isDisposed||(this._isDisposed=!0,this.disconnectFromCellMetadataChangedSignal(),d.Signal.clearData(this))}get isDeferred(){return this._isDeferred}set isDeferred(e){this._isDeferred=e,this._isDeferredChanged.emit()}get isDeferredChanged(){return this._isDeferredChanged}get isDisposed(){return this._isDisposed}setHeight(e){this.setMetadataProperty(se,e)}setWidgetState(e){this.setMetadataProperty(re,e)}redo(){this.undoableState.redo()}undo(){this.undoableState.undo()}setMetadataProperty(e,t){const{current:n}=this;this.current={...n,[e]:t}}}const ge=e=>{const t=H(e.isDeferredChanged,{property:"isDeferred",sender:e}),n=(0,x.useCallback)((t=>{e.isDeferred=t}),[e]);return{isDeferred:t,setIsDeferred:n}},he=e=>{const t=(0,x.useCallback)((t=>{e.setWidgetState(t)}),[e]),{[re]:n}=H(e.changed,{property:"current",sender:e})??{};return{setWidgetState:t,widgetState:n}},pe=(0,x.createContext)(void 0),me=()=>{const e=(0,x.useContext)(pe);if(!e)throw new Error("Missing widget state trackers.");return e},ye=(0,x.createContext)(void 0),Ce=({cellModel:e,children:t,hasSnapshot:n})=>{const i=me(),s=z(i.created,(()=>i.get(e)));return s?(0,k.Y)(ye.Provider,{value:s,children:t}):(0,k.Y)(K,{hasSnapshot:n})},fe=()=>{const e=(0,x.useContext)(ye);if(!e)throw new Error("Missing widget state tracker.");return e};class we{_created=new d.Signal(this);widgetPlugins;widgetStateTrackers=new WeakMap;constructor({widgetPlugins:e}){this.widgetPlugins=e}get created(){return this._created}get(e){return this.widgetStateTrackers.get(e)}getOrCreate(e){return this.widgetStateTrackers.has(e)||(this.widgetStateTrackers.set(e,new ue(e,{widgetPlugins:this.widgetPlugins})),this._created.emit()),this.get(e)}}const ve=(0,x.createContext)(void 0),be=(0,x.createContext)(!1),Se=(0,x.createContext)(void 0),ke=({children:e,value:{dataModelClickListeners:t,intlTracker:n,jupyterLab:i,jupyterServerProxyEnabled:s,notebookTracker:r,pluginRegistry:o,popupContainer:a,sessionClients:l,themeTracker:d,widgetStateTrackers:c}})=>{const{locale:g,messages:h}=H(n.changed,{property:"config",sender:n}),p=H(d.changed,{property:"theme",sender:d}),m="atoti-popup-container";return(0,k.FD)(k.FK,{children:[(0,Y.createPortal)((0,k.Y)(u.ThemeProvider,{value:p,children:(0,k.Y)("div",{id:m})}),a),(0,k.Y)(M.ConfigProvider,{getPopupContainer:()=>document.querySelector(`#${m}`),children:(0,k.Y)(I.DndProvider,{backend:D.HTML5Backend,children:(0,k.Y)(P.IntlProvider,{locale:g,messages:h,children:(0,k.Y)(u.ThemeProvider,{css:{height:"100%"},value:p,children:(0,k.Y)(u.PluginsProvider,{value:o,children:(0,k.Y)(u.DataModelClickListenersProvider,{initialValue:t,children:(0,k.Y)(ve.Provider,{value:i,children:(0,k.Y)(be.Provider,{value:s,children:(0,k.Y)(Se.Provider,{value:r,children:(0,k.Y)(q.Provider,{value:l,children:(0,k.Y)(pe.Provider,{value:c,children:e})})})})})})})})})})})]})},Te=()=>{const e=(0,x.useContext)(ve);if(!e)throw new Error("Missing JupyterLab.");return e},Me=()=>(0,x.useContext)(be),xe=()=>{const e=(0,x.useContext)(Se);if(!e)throw new Error("Missing notebook tracker.");return e},Ie=(0,x.createContext)(null),De=Ie.Provider,Ye=()=>{const e=(0,x.useContext)(Ie);if(!e)throw new Error("Missing widget environment.");return e},Pe=(e,t)=>{for(let n=0;n<e.length;n++){const i=e.get(n);if(t(i))return i}},Ee="text/html",We=l.version.split(".",1).pop(),_e=`application/vnd.atoti.link.v${We}+json`,$e=`application/vnd.atoti.widget.v${We}+json`,Re=`application/vnd.atoti.convert-mdx-query-result-to-widget.v${We}+json`,je=({children:e})=>{const[t,n]=(0,x.useState)(),i=(0,x.useRef)(null);return(0,x.useEffect)((()=>{const e=i.current;e&&void 0===t&&n(null!==e.closest(".jp-LinkedOutputView"))}),[t]),void 0===t?(0,k.Y)("div",{ref:i}):e(t)};var Le=n(44331),Fe=n(77261),Ue=n(75816);const Ae=e=>{const{formatMessage:t}=(0,P.useIntl)(),{widgetKey:n}=(0,u.useSwitchedWidgetState)(e);return t({id:`aui.plugins.widget.${n}.defaultName`})};var Oe=n(98396);const Be="atoti-exclude-from-snapshot",Ne=async({code:e,notebookTracker:t,state:n})=>{const i=t.currentWidget;if(!i)throw new Error("Notebook has no current panel.");const s=i.model;if(!s)throw new Error("Current notebook panel has no model.");const o=i.content;if(s.sharedModel.insertCell(o.activeCellIndex+1,(({code:e,state:t})=>({cell_type:"code",execution_count:null,metadata:{[ie]:de({[re]:t})},outputs:[],source:e}))({code:e,state:n})),o.activeCellIndex++,!o.activeCell||!(0,v.isCodeCellModel)(o.activeCell.model))throw new Error("A code cell has just been inserted and activated, expected the the current active cell to be a code cell.");const a=o.activeCell;return await r.NotebookActions.run(o,i.sessionContext),a},Ke=e=>{const t=H(e.activeCellChanged,{property:"activeCell",sender:e});if(t&&(0,v.isCodeCellModel)(t.model))return t.model},ze=()=>{const e=xe(),t=Ke(e),{cellModel:n}=Ye();return t===n},He=({onChange:e,widgetState:t})=>{if(!e)throw new Error("Missing `onChange` prop.");const n=Ae(t),[i,s]=(0,x.useState)(t.name??n);(0,x.useEffect)((()=>{s(t.name??n)}),[n,t.name]);const r=(0,x.useCallback)((()=>{if(i&&i!==n)e({...t,name:i});else{const{name:i,...r}=t;s(n),e(r)}}),[n,e,s,i,t]);return(0,k.Y)(Ue.TitleInput,{css:{height:"100%",padding:2},isPlaceholder:!t.name,isStrictlySized:!1,value:i,onBlur:r,onChange:s})},qe=[],Ve=({onChange:e,queryId:t,widgetState:n})=>{const{widgetKey:i}=(0,u.useSwitchedWidgetState)(n),[s]=(0,Fe.useWidgetPlugins)([i]),r=(0,Le.useTitleBarButtonPlugins)(s.titleBarButtons??qe);return ze()?(0,k.Y)("div",{className:Be,css:{display:"flex",justifySelf:"end"},children:r.map((({Component:i,key:s})=>(0,k.Y)(i,{css:{marginRight:8},queryId:t,widgetState:n,onWidgetChange:e},s)))}):null},Qe=e=>(0,k.FD)("div",{css:{display:"flex",fontSize:16,height:36,justifyContent:"space-between"},children:[(0,k.Y)(He,{...e}),(0,k.Y)(Ve,{...e})]}),Je=(0,u.withWidgetLoadingBar)((e=>{const t=(0,x.forwardRef)(((t,n)=>(0,k.FD)("div",{ref:n,css:{height:"100%"},children:[(0,k.Y)(Qe,{...t}),(0,k.Y)("div",{css:{height:"calc(100% - 36px)"},children:(0,k.Y)(e,{...t})})]}))),n=e.displayName??e.name??"Unknown";return t.displayName=`withTitleBar(${n})`,t})(u.Widget));var Ge=n(77227);const Xe=({error:e})=>{const t=fe(),{formatMessage:n}=(0,P.useIntl)();return(0,k.FD)(B,{description:String(e),icon:(0,k.Y)(N.MehOutlined,{}),id:"widget.errored",children:[(0,k.FD)(M.Button,{danger:!0,onClick:()=>{t.current=void 0},children:[(0,k.Y)(N.ClearOutlined,{})," ",n({id:"widget.reset"})]}),t.canUndo?(0,k.FD)(M.Button,{css:{marginLeft:"4px !important",marginTop:"4px !important"},onClick:()=>{t.undo()},children:[(0,k.Y)(N.UndoOutlined,{})," ",n({id:"aui.plugins.titlebar-button.undo.key"})]}):null]})},Ze=({children:e,widgetLoadingTracker:t})=>{const n=(0,x.useCallback)((async e=>{t&&await t.handleError(e)}),[t]),i=fe(),s=he(i);return(0,k.Y)(Ge.ErrorBoundary,{FallbackComponent:Xe,resetKeys:[s],onError:n,children:e})},et=({children:e})=>{const{formatMessage:t}=(0,P.useIntl)(),n=ze(),{[l.defaultServerKey]:i}=(0,u.useConnectionStatuses)(),[s,r]=(0,x.useState)(!1),o=(0,x.useCallback)((()=>{r(!0)}),[]),a="disconnected"===i;return(0,x.useEffect)((()=>{r(!a)}),[a]),(0,k.FD)(x.Fragment,{children:[n&&a&&!s?(0,k.Y)("div",{css:{padding:4,position:"absolute",width:"100%",zIndex:1},children:(0,k.Y)(M.Alert,{closable:!0,showIcon:!0,className:Be,message:t({id:"widget.sessionDisconnected"}),type:"warning",onClose:o})}):null,e]})},tt=({children:e,widgetLoadingTracker:t})=>(0,k.Y)(et,{children:(0,k.Y)(Ze,{widgetLoadingTracker:t,children:e})}),nt=()=>{const e=(0,x.useRef)(null),{cellModel:{id:t}}=Ye(),n=fe(),{isDeferred:i}=ge(n),{setWidgetState:s,widgetState:r=n.defaultWidgetState}=he(n);return(0,x.useEffect)((()=>{const t=e.current;if(!t)throw new Error("Expected div to have been mounted and ref to have been set.");(e=>{let t=e;for(;t;)if(({parentElement:t}=t),t?.classList?.contains("jp-OutputArea-child"))return void(t.style.height="100%");throw new Error("Expected to find right parent element before exhausting them all.")})(t)}),[]),(0,k.Y)(Je,{ref:e,isDeferred:i,queryId:t,widgetState:r,onChange:s})},it=()=>{const{cellModel:e,mimeModel:t,sessionId:n}=Ye();return(0,k.Y)(Ce,{cellModel:e,hasSnapshot:Boolean(t.data[Ee]),children:(0,k.Y)(J,{sessionId:n,children:(0,k.Y)(tt,{children:(0,k.Y)(nt,{})})})})};var st=n(62795);class rt{widgetId;sessionClient;toldLoadingDone=!1;constructor({sessionClient:e,widgetId:t}){this.sessionClient=e,this.widgetId=t}async done(){const e=F(this.sessionClient.versions);if(this.toldLoadingDone||!e)return;this.toldLoadingDone=!0;const t=`${e.restPath}/widgets/${this.widgetId}/loading`;await this.sessionClient.fetch(t,{method:"DELETE"})}async handleError(e){await this.done()}}class ot{_changed=new d.Signal(this);cellModels;messages=new WeakMap;constructor({cellModels:e}){this.cellModels=e}get changed(){return this._changed}get(e){return this.messages.get(e)}register(e){this._changed.emit(),e.registerCommTarget("atoti-widget",((e,{content:{data:t}})=>{const n=t;try{const{cellId:e}=n,t=[...this.cellModels].find((({id:t})=>e===t));if(!t)throw new Error(`Missing model for cell #${e}`);if(!(0,v.isCodeCellModel)(t))throw new Error(`Expected cell #${e} to be a code cell`);const i=Pe(t.outputs,(e=>void 0!==e.data[$e]));if(!i)throw new Error(`Expected cell #${e} to have a widget output`);this.messages.set(i,n),this._changed.emit()}catch(e){console.error(e)}}))}}const at="atoti-sidebar",lt=({jupyterLab:e})=>{e.shell.activateById(at)};var dt=n(40391),ct=n(35256);const ut=({children:e,collapsedTitle:t,expandedTitle:n,isDisabled:i,isExpanded:s,onToggled:r})=>{const o=(0,u.useTheme)(),a=(0,x.useCallback)((()=>{r&&r(!s)}),[s,r]);return s?(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:{alignItems:"center",backgroundColor:o.alternateBackgroundColor,borderBottom:`1px solid ${o.grayScale[5]}`,cursor:"pointer",display:"flex",height:20,justifyContent:"space-between",padding:8},onClick:a,children:[(0,k.Y)("div",{css:{fontSize:"11px",textTransform:"uppercase",width:"100%"},children:n}),(0,k.Y)("div",{css:{color:o.textColor},children:!i&&(0,k.Y)(N.DoubleLeftOutlined,{})})]}),(0,k.Y)("div",{css:{height:"calc(100% - 20px)"},children:e})]}):(0,k.FD)("div",{css:{height:"100%"},onClick:a,children:[(0,k.Y)("div",{css:{alignItems:"center",backgroundColor:o.alternateBackgroundColor,borderBottom:`1px solid ${o.cellBorderColor}`,borderRight:`1px solid ${o.cellBorderColor}`,display:"flex",height:20,justifyContent:"center"},children:(0,k.Y)("div",{css:{cursor:"pointer"},children:(0,k.Y)(N.DoubleRightOutlined,{})})}),(0,k.Y)("div",{css:{backgroundColor:o.alternateBackgroundColor,borderRight:`1px solid ${o.cellBorderColor}`,cursor:"pointer",height:"100%",textAlign:"center",whiteSpace:"nowrap"},children:t})]})};var gt=n(84951);const{OptGroup:ht,Option:pt}=M.Select,mt=({onChange:e,queryId:t,widgetState:n})=>{const{formatMessage:i}=(0,P.useIntl)(),s=(0,u.useTheme)(),r=(0,gt.useIsQueryLazyLoaded)({queryId:t,widgetState:n}),o=(e=>{const t=(0,u.useWidgetPlugins)(e),n=(0,x.useMemo)((()=>{const e=[];for(const n of t)(0,gt.isDataVisualizationWidgetPlugin)(n)&&e.push(n);return e}),[t]);return n})((0,u.useWidgetPluginKeys)()),{mapping:a,widgetKey:l}=(0,u.useSwitchedWidgetState)(n),{attributes:d}=o.find((({key:e})=>e===l)),c=(0,x.useMemo)((()=>{const e={};for(const t of Object.values(o)){const o=t.subCategory??"misc";e[o]||=[];const l=t.Icon??N.QuestionOutlined,{maxNumberOfFields:c,status:u}=(0,gt.getSwitchAvailability)(a,d,t),g=r&&!t.lazyLoading||"ok"!==u;e[o].push((0,k.Y)(pt,{disabled:g,value:t.key,children:(0,k.FD)(M.Tooltip,{title:g?(0,k.Y)(gt.WidgetIconTooltip,{isQueryLazyLoaded:r,selectedWidgetState:n,widgetOption:{...t,disabledType:"tooManyNumeric"===u?"numeric":"ordinal",isSwitchDisabled:g,maxNumberOfFields:c}}):void 0,children:[(0,k.Y)(l,{css:{color:s.primaryColor,marginRight:4}})," ",i({id:`aui.plugins.widget.${t.key}.key`})]})},t.key))}return e}),[d,o,i,r,a,s.primaryColor,n]);return(0,k.Y)(M.Select,{css:{height:28,width:"100%"},listHeight:30*Object.keys(o).length,value:l,onChange:t=>{e((0,te.produce)(n,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t})))},children:Object.entries(c).map((([e,t])=>(0,k.Y)(ht,{label:i({id:`aui.dataVisualization.category.${e}`}),children:t},e)))})},yt=()=>{const e=fe(),{isDeferred:t,setIsDeferred:n}=ge(e),{formatMessage:i}=(0,P.useIntl)();return(0,k.Y)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",height:26,justifyContent:"flex-end"},children:(0,k.Y)(M.Checkbox,{checked:t,onChange:e=>{n(e.target.checked)},children:i({id:"sidebar.deferUpdates"})})})},Ct=({activeToolKey:e,onActiveToolKeyChanged:t,tools:n})=>(0,k.Y)(M.Tabs,{css:{".ant-tabs-nav-operations":{".ant-tabs-nav-more":{alignItems:"center",display:"flex"},margin:"0 !important",padding:"0 !important"},"div.ant-tabs-tab-btn span.tab-item-label":{display:"none"}},activeKey:e,items:n.map((e=>({key:e.key,label:(0,k.Y)("span",{css:{".anticon":{marginRight:"0 !important"},display:"flex"},children:(0,k.Y)(e.icon,{})})}))),tabBarStyle:{height:20,marginTop:5,paddingLeft:8},type:"card",onTabClick:t}),ft=({cellId:e})=>{const{formatMessage:t}=(0,P.useIntl)(),n=(0,u.useTheme)(),i=fe(),{setWidgetState:s,widgetState:r=i.defaultWidgetState}=he(i),o=(0,u.useSwitchedWidgetState)(r),[a,d]=(0,x.useState)(240),[c,h]=(0,x.useState)("contentEditor"),{cube:{name:p}}=(0,u.useCube)(o),[m,y]=(0,x.useState)(!0),{component:C}=g.find((({key:e})=>e===c)),f=`1px solid ${n.cellBorderColor}`;return(0,k.FD)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-end"},children:[Z(o)?(0,k.Y)("div",{css:{borderBottom:f,padding:"6px 8px"},children:(0,k.Y)(mt,{queryId:e,widgetState:o,onChange:s})}):null,(0,k.Y)("div",{css:{borderBottom:f,height:`calc(100% - ${26+(Z(o)?41:0)+1}px)`},children:(0,k.FD)(u.Resizable,{minSize:m?100:34,size:m?a??240:34,onResizeEnd:d,children:[(0,k.Y)(ut,{collapsedTitle:(0,k.Y)("div",{css:{backgroundColor:n.alternateBackgroundColor,display:"inline-block",marginTop:70,textTransform:"uppercase",transform:"rotate(-90deg)",width:15},children:t({id:"aui.dataModel"})}),expandedTitle:t({id:"aui.dataModel"}),isExpanded:m,onToggled:y,children:(0,k.Y)("div",{css:{display:"flex",height:"100%",width:"100%"},children:(0,k.Y)(u.DataModelTree,{cubeName:p,marginLeft:8,serverKey:l.defaultServerKey})})}),(0,k.FD)("div",{css:{height:"100%"},children:[(0,k.Y)("div",{css:{alignItems:"center",backgroundColor:n.alternateBackgroundColor,borderBottom:`1px solid ${n.grayScale[5]}`,display:"flex",fontSize:"11px",height:20,padding:8,textTransform:"uppercase"},children:t({id:"aui.tools"})}),(0,k.Y)(Ct,{activeToolKey:c,tools:g,onActiveToolKeyChanged:h}),(0,k.Y)("div",{css:{height:"calc(100% - 33px)",padding:"0px 8px"},children:(0,k.Y)(C,{widgetState:o,queryId:e,onWidgetChange:s})})]})]})}),(0,k.Y)(yt,{})]})},wt=()=>{const e=xe(),t=Ke(e),n=(e=>{H(e?.outputs.changed,{property:"length",sender:e?.outputs});const t=e?Pe(e.outputs,(e=>void 0!==e.data[$e])):void 0;if(!t)return;const{data:n}=t;return{hasSnapshot:Ee in n,widgetOutput:n[$e]}})(t);if(!t||!n)return(0,k.Y)(B,{icon:(0,k.Y)(u.IconPuzzle,{}),id:"sidebar.noWidgetSelected"});const{hasSnapshot:i,widgetOutput:s}=n;return(0,k.Y)(Ce,{cellModel:t,hasSnapshot:i,children:(0,k.Y)(J,{sessionId:s.sessionId,children:(0,k.Y)(Ze,{children:(0,k.Y)(ft,{cellId:t.id})})})})},vt="atoti-icon",bt="jp-SideBar-tabIcon",St=`.${vt}.${bt}`;class kt extends ct.Widget{constructor(e){super(),this.id=at,this.title.caption="Atoti",this.title.iconClass=`${bt} ${vt}`;const t=s.ReactWidget.create((0,k.FD)(x.Fragment,{children:[(0,k.Y)(dt.Global,{styles:{[St]:{backgroundColor:"var(--md-grey-700)",backgroundImage:"none",maskImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 256 256'%3E%3Cpath fill='%23fff' d='M165.883 208.19h-75.8l-7.342 25.99H30.456l72.467-213.997h49.82l72.759 213.996h-52.267Zm-10.991-38.818-27.21-94.467-26.904 94.467Z'/%3E%3C/svg%3E%0A\");",maskPosition:"center",maskRepeat:"no-repeat",maskSize:"contain"},[`[data-jp-theme-light="false"] ${St}`]:{backgroundColor:"var(--md-grey-300)"}}}),(0,k.Y)(ke,{value:e,children:(0,k.Y)(wt,{})})]})),{style:n}=t.node;n.height="100%",n.padding="0";const i=new ct.PanelLayout;i.addWidget(t),this.layout=i}}const Tt=({widgetLoadingTracker:e,widgetRef:t})=>{const{cellModel:{id:n}}=Ye(),i=fe(),{isDeferred:s,setIsDeferred:r}=ge(i),{setWidgetState:o,widgetState:a}=he(i),d=a??i.defaultWidgetState,c=(p=e,(0,x.useEffect)((()=>()=>{(async()=>{await p.done()})()}),[p]),(0,x.useCallback)((async()=>{await p.done()}),[p])),g=(e=>{const{cellModel:{id:t},mimeModel:n,preSaveSubscribe:i}=Ye(),s=(0,x.useRef)(!1),r=fe(),{widgetState:{name:o}={}}=he(r),a=(0,x.useCallback)((e=>{const{[Ee]:t,...i}=n.data;n.setData({data:e?{...i,[Ee]:`<img height="${e.height}" width="${e.width}" src="${e.src}" />`}:i})}),[n]),{error:d}=(0,u.useQueryResult)({queryId:t,serverKey:l.defaultServerKey});return(0,x.useEffect)((()=>{let t=!1;const n=i((async()=>{let n;if(s.current&&!d&&e.current)try{const t=Date.now(),{clientHeight:i,clientWidth:s}=e.current;n={height:i,src:await(async e=>await(0,Oe.domToPng)(e,{filter:e=>!(e=>e.nodeType===e.ELEMENT_NODE)(e)||!e.classList.contains(Be),scale:window.devicePixelRatio??1}))(e.current),width:s};const r=Date.now();console.debug(`Snapshotted widget "${o}" in ${(r-t)/1e3} seconds.`)}catch(e){throw new Error("Failed to snapshot widget",{cause:e})}t||a(n)}));return()=>{t=!0,n()}}),[d,o,i,a,e]),(0,x.useCallback)((()=>{s.current=!0}),[])})(t),h=(0,x.useCallback)((()=>{c(),g()}),[c,g]);var p;(e=>{const t=Te();(0,x.useEffect)((()=>{e&&lt({jupyterLab:t})}),[e,t])})(void 0===a),(e=>{(0,x.useEffect)((()=>()=>{e(!1)}),[e])})(r),(()=>{const e=G();(0,x.useEffect)((()=>e.subscribe()),[e])})();const m=ze();return(0,k.Y)(Je,{isDeferred:s,queryId:n,widgetState:d,isSelected:m,onLoaded:h,onChange:o})};var Mt=n(8598);const xt=":",It=`atoti${xt}`,Dt=e=>void 0!==e,Yt=(...e)=>{if(!window.__UNSTABLE_DATA_TEST_IDS_ENABLED__)return;const t=e.at(-1);if((0,A.isPlainObject)(t)){const n=t["data-testid"],i=e.slice(0,-1).filter(Dt);if(n){const e=n.replace(It,"");return`${It}${[...i.filter(Dt),e].join(xt)}`}return`${It}${i.join(xt)}`}return`${It}${e.filter(Dt).join(xt)}`},Pt="atoti-resize-handle",Et=(0,x.forwardRef)((({children:e},t)=>{const n=fe(),{height:i,setHeight:s}=(e=>{const t=(0,x.useCallback)((t=>{e.setHeight(t)}),[e]),{height:n=oe}=H(e.changed,{property:"current",sender:e})??{};return{height:n,setHeight:t}})(n),{widgetState:{name:r}={}}=he(n),o=(0,u.useTheme)();return(0,k.Y)(dt.ClassNames,{children:({css:n})=>(0,k.Y)(Mt.Resizable,{handleClasses:{bottom:`${Pt} ${n({backgroundColor:o.grayScale[6],borderRadius:2,borderTop:"unset",height:"4px !important",marginBottom:6,marginLeft:"calc(50% - 16px)",opacity:.4,width:"32px !important"})}`},size:{height:i,width:"100%"},enable:{bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1},css:{[`&:hover .${Pt}`]:{display:"inherit"},overflow:"hidden",paddingBottom:8},onResizeStop:(e,t,n,r)=>{s(i+r.height)},children:(0,k.Y)("div",{ref:t,css:{height:"100%"},"data-testid":Yt("Widget",r),children:e})})})})),Wt=({html:e})=>{const t=(0,P.useIntl)(),{cellModel:n}=Ye(),i=(e=>ae(e)?.[re]?.name??void 0)(n);return(0,k.Y)("div",{dangerouslySetInnerHTML:{__html:e},css:{cursor:"help"},"data-testid":Yt("WidgetSnapshot",i),title:t.formatMessage({id:"widget.snapshotSelected.description"})})},_t=()=>{const e=(0,x.useRef)(null),{cellModel:t,mimeModel:n,sessionId:i}=Ye(),s=(()=>{const e=Me(),t=V(),{cellModel:n,mimeModel:i,sessionId:s,sessionUrl:r,widgetComm:o}=Ye(),a=me(),l=((e,t)=>z(e.changed,(()=>e.get(t))))(o,i),{error:d,result:c}=(0,st.useAsyncAbortable)((async i=>{if(!l)return;const{sessionHeaders:o,widgetId:d}=l,c=await t.getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:o,sessionId:s,sessionUrl:r,signal:i});return a.getOrCreate(n),new rt({sessionClient:c,widgetId:d})}),[n,e,t,s,r,l,a]);return d??c})(),r=me().get(t);return s instanceof Error?(0,k.Y)("div",{css:{height:ce(t)},children:(0,k.Y)(B,{description:s.message,icon:(0,k.Y)(N.DisconnectOutlined,{}),id:"widget.connectionFailed"})}):s&&r?(0,k.Y)(Ce,{cellModel:t,children:(0,k.Y)(Et,{ref:e,children:(0,k.Y)(J,{sessionId:i,children:(0,k.Y)(tt,{widgetLoadingTracker:s,children:(0,k.Y)(Tt,{widgetLoadingTracker:s,widgetRef:e})})})})}):n.data[Ee]?(0,k.Y)(Wt,{html:n.data[Ee]}):(0,k.Y)("div",{css:{height:ce(t)},children:(0,k.Y)(K,{})})},$t=()=>(0,k.Y)(je,{children:e=>e?(0,k.Y)(it,{}):(0,k.Y)(_t,{})});class Rt extends r.NotebookTools{cellModels;cleanUpFunctions=[];preSaveSubscribe;root;sharedContext;widgetComm;constructor({cellModels:e,preSaveSubscribe:t,sharedContext:n,widgetComm:i}){super({tracker:n.notebookTracker}),this.cellModels=e,this.preSaveSubscribe=t,this.root=(0,T.H)(this.node),this.sharedContext=n,this.widgetComm=i}async renderModel(e){const t=((e,{cellModels:t})=>{for(const n of t)if((0,v.isCodeCellModel)(n)&&Pe(n.outputs,(t=>t===e)))return n;throw new Error(`Could not find matching cell for model: ${JSON.stringify(e)}`)})(e,{cellModels:this.cellModels}),n=e.data[$e],{sessionId:i,sessionUrl:s}=n;this.root.render((0,k.Y)(ke,{value:this.sharedContext,children:(0,k.Y)(De,{value:{cellModel:t,mimeModel:e,preSaveSubscribe:this.preSaveSubscribe,sessionId:i,sessionUrl:s,widgetComm:this.widgetComm},children:(0,k.Y)($t,{})})})),this.cleanUpFunctions.push((()=>{this.root.unmount()}))}handleEvent(e){if(e instanceof MouseEvent&&!e.shiftKey&&e.target){const t=new MouseEvent("contextmenu",{bubbles:!0,clientX:e.clientX,clientY:e.clientY,shiftKey:!0});e.stopPropagation(),e.preventDefault(),t.initEvent(t.type,!0,!0),e.target.dispatchEvent(t)}}onAfterAttach(){const e={capture:!0};this.node.addEventListener("contextmenu",this,e),this.cleanUpFunctions.push((()=>{this.node.removeEventListener("contextmenu",this,e)}))}onBeforeDetach(){for(const e of this.cleanUpFunctions)e()}}class jt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){const n=(e=>{let{save:t}=e;t=t.bind(e);const n=new S;return e.save=async()=>{try{await n.run()}catch(e){console.error("Pre save hook failed to run",e)}await t()},n.subscribe.bind(n)})(t),{content:i,model:s}=e;if(null===s)throw new Error("Session model should not be null at this time");const{cells:r}=s,o=new ot({cellModels:r});i.rendermime.addFactory({createRenderer:()=>new Rt({cellModels:r,preSaveSubscribe:n,sharedContext:this.sharedContext,widgetComm:o}),defaultRank:0,mimeTypes:[$e],safe:!1});const{sessionContext:a}=t,l=(e,{newValue:t})=>{t&&o.register(t)};a.kernelChanged.connect(l);const d=((e,{cellModels:t})=>(n,i)=>{if("idle"===i)for(const n of[...t].filter((t=>{const n=e.get(t);return n?.current&&(0,v.isCodeCellModel)(t)&&t.outputs.length>0&&!Pe(t.outputs,(e=>"error"===e.type||void 0!==e.data[$e]))})))e.get(n).current=void 0})(this.sharedContext.widgetStateTrackers,{cellModels:r});return a.statusChanged.connect(d),new b.DisposableDelegate((()=>{a.kernelChanged.disconnect(l),a.statusChanged.disconnect(d)}))}}const Lt="convert-mdx-query-result-to-widget",Ft=`atoti:${Lt}`,Ut=".jp-Notebook .jp-CodeCell .dataframe",At=e=>{const{activeCell:t}=e,n=t&&(0,v.isCodeCellModel)(t.model)&&Pe(t.model.outputs,(e=>void 0!==e.data[Re]));return n?n.data[Re]:void 0},Ot=E.URLExt.join(E.PageConfig.getBaseUrl(),"server-proxy","servers-info"),Bt=async()=>{try{if((await fetch(Ot)).ok)return!0}catch{}return!1},Nt=({output:{path:e,sessionUrl:t}})=>{const n=Me(),{error:i,result:s}=(0,st.useAsyncAbortable)((async e=>{const{sessionUrl:i}=await L(t,{jupyterServerProxyEnabled:n,signal:e});return i}),[n,t]);if(void 0!==i)return(0,k.Y)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:i.message});if(void 0===s)return null;const r=U(s,e);return(0,k.Y)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:(0,k.Y)("pre",{children:(0,k.Y)("a",{css:{":hover":{color:"var(--jp-content-link-color)",textDecoration:"underline"},color:"var(--jp-content-link-color)"},"data-testid":Yt("Link"),href:r,target:"_blank",rel:"noopener noreferrer",children:r})})})};class Kt extends r.NotebookTools{root;sharedContext;constructor(e){super({tracker:e.notebookTracker}),this.root=(0,T.H)(this.node),this.sharedContext=e}async renderModel(e){this.root.render((0,k.Y)(ke,{value:this.sharedContext,children:(0,k.Y)(Nt,{output:e.data[_e]})}))}onBeforeDetach(){this.root.unmount()}}class zt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){return e.content.rendermime.addFactory({createRenderer:()=>new Kt(this.sharedContext),defaultRank:0,mimeTypes:[_e],safe:!1}),new b.DisposableSet}}var Ht=n(30540),qt=n(7845),Vt=n(21041);const Qt="open-drillthrough",Jt={key:Qt,translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"}},useMenuItem:e=>{const{selection:t,widgetState:n}=e,{cube:i}=(0,u.useCube)(n),{formatMessage:s}=(0,P.useIntl)(),r=Te(),o=xe(),{mimeModel:a}=Ye(),{widgetCreationCode:d}=a.data[$e],c=(0,x.useMemo)((()=>{if((0,Vt.canOpenDrillthroughOnSelection)(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,Ht.isTotal)((0,u.getHierarchy)(e,i),e)))}),[i,t]),g=(0,x.useMemo)((()=>{if(!c)return;const e=c.filter((e=>"Measures"!==e.dimensionName));return s({id:`aui.plugins.menu-item.${Qt}.openDrillthrough`},{member:e.length>0?(0,Ht.getTupleCaption)(e,{captionForTotals:s({id:"aui.total"}),cube:i,hasOnlyCaptionForLeafLevels:!0,separator:", "}):void 0})}),[s,c,i]),{execute:h,loading:p}=(0,st.useAsyncCallback)((async()=>{if(g&&c&&n.query.mdx){const e=(0,Vt.getDrillthroughWidgetFilters)({sourceWidgetFilters:n.filters,tuple:c}),t={...u.pluginWidgetDrillthroughTable.initialState,filters:e,initialCubeName:i.name,query:{...u.pluginWidgetDrillthroughTable.initialState.query,mdx:(0,qt.getDefaultMdxDrillthrough)(i.name)},serverKey:l.defaultServerKey};lt({jupyterLab:r}),await Ne({code:d,notebookTracker:o,state:t})}}));if(c&&n.query.mdx)return{disabled:p,icon:(0,k.Y)(u.IconDrillthrough,{css:{marginRight:8}}),label:g,onClick:h}}},{Link:Gt,Text:Xt}=M.Typography,Zt="save-widget-in-app",en={key:Zt,translations:{"en-US":{errorMessage:"Widget could not be saved in app",saveWidgetInApp:"Save widget in app",successDescription:"Go to <a>the app</a>, create or open a dashboard, and open the <b>Insert > <i>icon</i> Saved widgets</b> menu to find your widget.",successMessage:"Widget saved in app",unsupportedSession:"Widgets can only be saved in sessions started with Atoti Python SDK."}},useMenuItem:e=>{const{notification:t}=M.App.useApp(),{formatMessage:n,locale:i,messages:s}=(0,P.useIntl)(),{url:r}=(0,u.useAtotiClient)(l.defaultServerKey),{contentClient:o,versions:a}=G(),{username:d}=(0,u.useUser)(),{widgetState:c}=e,g=Ae(c),{execute:h,loading:p}=(0,st.useAsyncCallback)((async()=>{const{name:e,widgetKey:a,...l}=(0,u.serializeWidgetState)(c),h=[d];try{await o.createFile({content:l,metaData:{name:e??g,version:0,widgetKey:a},owners:h,pathToParentFolder:[],readers:h,type:"widget"});const d=U(r);t.success({description:(0,k.Y)(P.IntlProvider,{locale:i,messages:s,children:(0,k.Y)(P.FormattedMessage,{id:`aui.plugins.menu-item.${Zt}.successDescription`,values:{a:e=>(0,k.Y)(Gt,{href:d,target:"_blank",rel:"noopener noreferrer",children:e}),b:e=>(0,k.Y)(Xt,{strong:!0,children:e}),i:()=>(0,k.Y)(u.IconPuzzle,{})}})}),message:n({id:`aui.plugins.menu-item.${Zt}.successMessage`})})}catch(e){console.error(e),t.error({description:String(e),message:n({id:`aui.plugins.menu-item.${Zt}.errorMessage`})})}})),m=o&&F(a),y=!m||p,C=m?void 0:n({id:`aui.plugins.menu-item.${Zt}.unsupportedSession`});return{disabled:y,icon:(0,k.Y)(N.DeliveredProcedureOutlined,{}),label:n({id:`aui.plugins.menu-item.${Zt}.saveWidgetInApp`}),onClick:h,title:C}}},tn=e=>(0,A.keyBy)(e,"key"),nn=["undo","redo"],sn=(e,{notebookTracker:t,widgetStateTrackers:n})=>()=>{const{disabledTextColor:i}=(0,u.useTheme)(),s=Ke(t),r=z(n.created,(()=>s&&n.get(s))),{formatMessage:o}=(0,P.useIntl)();H(r?.changed,{property:"current",sender:r});let a=!1;r&&(a="undo"===e?r.canUndo:r.canRedo);const l=(0,x.useCallback)((()=>{a&&r&&("undo"===e?r.undo():r.redo())}),[a,r]),[d,c]=(0,x.useState)(!1),g=(0,x.useCallback)((()=>{c(!0)}),[]),h=(0,x.useCallback)((()=>{c(!1)}),[]),p=o(a?{id:`aui.plugins.titlebar-button.${e}.key`}:{id:`aui.plugins.titlebar-button.${e}.nothingToUndoRedo`}),m="undo"===e?N.UndoOutlined:N.RedoOutlined;return(0,k.Y)(M.Tooltip,{placement:"bottom",title:p,open:d,children:(0,k.Y)(m,{css:{color:a?void 0:i,cursor:a?void 0:"not-allowed !important",padding:"0px 4px"},onClick:l,onMouseEnter:g,onMouseLeave:h})})},rn=[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable,u.pluginWidgetTable,u.pluginWidgetKpi,u.pluginWidgetPlotlyLineChart,u.pluginWidgetPlotlyAreaChart,u.pluginWidgetPlotlyStackedAreaChart,u.pluginWidgetPlotly100StackedAreaChart,u.pluginWidgetPlotlyStackedColumnChart,u.pluginWidgetPlotlyClusteredColumnChart,u.pluginWidgetPlotly100StackedColumnChart,u.pluginWidgetPlotlyColumnsAndLinesChart,u.pluginWidgetPlotlyStackedBarChart,u.pluginWidgetPlotlyClusteredBarChart,u.pluginWidgetPlotly100StackedBarChart,u.pluginWidgetPlotlyPieChart,u.pluginWidgetPlotlyDonutChart,u.pluginWidgetPlotlyScatterPlot,u.pluginWidgetPlotlyRadarChart,u.pluginWidgetPlotlyWaterfallChart,u.pluginWidgetPlotlyBulletChart,u.pluginWidgetPlotlyGaugeChart,u.pluginWidgetPlotlyTreeMap,u.pluginWidgetDrillthroughTable];u.pluginWidgetDrillthroughTable.cellStyle=u.pluginCellStyleDrillthroughTable.key,u.pluginWidgetDrillthroughTable.contextMenuItems=[u.pluginMenuItemSortDrillthroughTableAscendingly.key,u.pluginMenuItemSortDrillthroughTableDescendingly.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportDrillthroughToCsv.key];const on=rn.filter((({key:e})=>e.startsWith("plotly"))),an=new Set(["bar","column","line"]);for(const e of on)e.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Jt.key,u.pluginMenuItemSortChartAscendingly.key,u.pluginMenuItemSortChartDescendingly.key,u.pluginMenuItemRemoveSort.key,...e.subCategory&&an.has(e.subCategory)?[u.pluginMenuItemShowHideChartTotals.key]:[],u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportToCsv.key];u.pluginWidgetPivotTable.cell=u.pluginCellPivotTable.key,u.pluginWidgetPivotTable.cellStyle=u.pluginCellStylePivotTable.key,u.pluginWidgetTable.cell=u.pluginCellTable.key,u.pluginWidgetTable.cellStyle=u.pluginCellStyleTable.key,u.pluginWidgetTreeTable.cell=u.pluginCellTreeTable.key,u.pluginWidgetTreeTable.cellStyle=u.pluginCellStylePivotTable.key;const ln=[u.pluginMenuItemFilterOnSelection.key,Jt.key,u.pluginMenuItemRemoveSort.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemHideColumns.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable])e.contextMenuItems=[u.pluginMenuItemSortPivotTableAscendingly.key,u.pluginMenuItemSortPivotTableDescendingly.key,...ln];u.pluginWidgetTable.contextMenuItems=[u.pluginMenuItemSortTableAscendingly.key,u.pluginMenuItemSortTableDescendingly.key,...ln],u.pluginWidgetKpi.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Jt.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of rn)e.contextMenuItems.push(en.key),e.titleBarButtons=[...nn];const dn=async({settingRegistry:e})=>{const t="windowingMode",n="defer";await e.set("@jupyterlab/notebook-extension:tracker",t,n),console.debug(`Updated the ${t} setting to ${n} to make all widgets snapshotable.`)},cn={async activate(e,t,n,i,s,r){window.localStorage.getItem("_atotiEnableTestIds")===JSON.stringify(!0)&&(window.__UNSTABLE_DATA_TEST_IDS_ENABLED__=!0);const o=e,{docRegistry:d,shell:c}=o;console.debug(`Activating Atoti Python SDK extension ${l.version} (relying on Atoti UI ${a.atotiUIVersion})`);const g=new we({widgetPlugins:rn}),h=(({notebookTracker:e,widgetStateTrackers:t})=>nn.map((n=>({Component:sn(n,{notebookTracker:e,widgetStateTrackers:t}),key:n,translations:{"en-US":{key:"undo"===n?"Undo":"Redo",nothingToUndoRedo:"Nothing to "+("undo"===n?"undo":"redo")}}}))))({notebookTracker:t,widgetStateTrackers:g}),p=(({undoRedoTitleBarButtonPlugins:e,widgetPlugins:t})=>({cell:tn([u.pluginCellPivotTable,u.pluginCellTable,u.pluginCellTreeTable]),"cell-style":tn([u.pluginCellStyleDrillthroughTable,u.pluginCellStylePivotTable,u.pluginCellStyleTable]),"menu-item":tn([u.pluginMenuItemCopyQuery,u.pluginMenuItemExportDrillthroughToCsv,u.pluginMenuItemExportToCsv,u.pluginMenuItemFilterOnSelection,Jt,en,u.pluginMenuItemRemoveSort,u.pluginMenuItemHideColumns,u.pluginMenuItemShowHideChartTotals,u.pluginMenuItemShowHideTotals,u.pluginMenuItemSortDrillthroughTableAscendingly,u.pluginMenuItemSortDrillthroughTableDescendingly,u.pluginMenuItemSortChartAscendingly,u.pluginMenuItemSortChartDescendingly,u.pluginMenuItemSortPivotTableAscendingly,u.pluginMenuItemSortPivotTableDescendingly,u.pluginMenuItemSortTableAscendingly,u.pluginMenuItemSortTableDescendingly]),"titlebar-button":tn(e),widget:tn(t)}))({undoRedoTitleBarButtonPlugins:h,widgetPlugins:rn}),[m,y,f,v]=await Promise.all([C.create({pluginRegistry:p,settingRegistry:n}),Bt(),dn({settingRegistry:n}),w.create(i)]),b=(()=>{const e=document.createElement("div");return document.body.append(e),e})(),S=new X,k={dataModelClickListeners:{byDefault:new Set,regular:new Set},intlTracker:m,jupyterLab:o,jupyterServerProxyEnabled:y,notebookTracker:t,pluginRegistry:p,popupContainer:b,sessionClients:S,themeTracker:v,widgetStateTrackers:g},T=new kt(k);c.add(T,"left",{rank:700}),r&&r.add(T,"atoti-sidebar"),d.addWidgetExtension("Notebook",new jt(k)),d.addWidgetExtension("Notebook",new zt(k)),(({commandPalette:e,intlTracker:t,jupyterLab:n,notebookTracker:i,sessionClients:s,widgetStateTrackers:r})=>{n.commands.addCommand(Ft,{async execute(){const{mdx:e,sessionId:t,widgetCreationCode:o}=At(i),a={...u.pluginWidgetPivotTable.initialState,serverKey:l.defaultServerKey},d=await Ne({code:o,notebookTracker:i,state:a}),c=s.get(t);if(!c)throw new Error("The execution of the created cell should have created the corresponding SessionClient.");const g=r.get(d.model);if(!g)throw new Error("The execution of the created cell should have created the corresponding WidgetStateTracker.");const h=await(async e=>e.dataModel?e.dataModel:new Promise((t=>{const n=e.subscribeToDataModel((()=>{const{dataModel:i}=e;i&&(n(),t(i))}))})))(c.atotiClient),{widgetStateDerivedFromMdx:p}=(0,gt.deriveStateFromMdx)({dataModels:{[l.defaultServerKey]:h},mdx:(0,u.parse)(e),widgetPlugin:u.pluginWidgetPivotTable,widgetState:a});g.setWidgetState(p),lt({jupyterLab:n})},isVisible:()=>void 0!==At(i),label:()=>(0,P.createIntl)(t.config).formatMessage({id:`commands.${Lt}.caption`})}),n.contextMenu.addItem({command:Ft,selector:Ut}),n.contextMenu.addItem({selector:Ut,type:"separator"}),e&&e.addItem({category:"Notebook Cell Operations",command:Ft})})({commandPalette:s,intlTracker:m,jupyterLab:o,notebookTracker:t,sessionClients:S,widgetStateTrackers:g})},autoStart:!0,id:"atoti",optional:[s.ICommandPalette,i.ILayoutRestorer],requires:[r.INotebookTracker,o.ISettingRegistry,s.IThemeManager]},un=cn},20625:(e,t,n)=>{var i={"./en-US.js":[12024,2024]};function s(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((()=>n(s)))}s.keys=()=>Object.keys(i),s.id=20625,e.exports=s},74389:(e,t,n)=>{"use strict";n.d(t,{FD:()=>a,FK:()=>r,Y:()=>o});var i=n(65723),s=n(42369),r=(n(93345),n(77619),n(4674),n(21880),n(48785),i.Fragment);function o(e,t,n){return s.h.call(t,"css")?i.jsx(s.E,(0,s.c)(e,t),n):i.jsx(e,t,n)}function a(e,t,n){return s.h.call(t,"css")?i.jsxs(s.E,(0,s.c)(e,t),n):i.jsxs(e,t,n)}},58997:(e,t,n)=>{"use strict";var i=n(7628);t.H=i.createRoot,i.hydrateRoot},62921:(e,t,n)=>{"use strict";var i=n(93345),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var i,r={},d=null,c=null;for(i in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:d,ref:c,props:r,_owner:a.current}}t.Fragment=r,t.jsx=d,t.jsxs=d},65723:(e,t,n)=>{"use strict";e.exports=n(62921)}}]);