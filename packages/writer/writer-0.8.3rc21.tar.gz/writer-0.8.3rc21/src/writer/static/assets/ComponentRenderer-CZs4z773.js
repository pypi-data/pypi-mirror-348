import{d as j,i as $,a as f,c as m,o as T,b as X,B as ve,e as L,f as v,t as R,g as me,h as fe,u as ge,r as x,p as E,w as O,F as ye,j as A,k as ee,_ as Y,l as _e,m as he,n as te,q as N,v as Q,s as ne,x as Ce,y as be,W as Se,z as Ie,A as Pe,C as se,D as Ee,E as we,G as Me,H as Te,I as $e,J as ke,K as Be,L as De,M as Z}from"./index-ChWW_c_j.js";import{f as Ae}from"./instancePath-BsbOTTI8.js";const Re=10,xe=j({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(b){const s=$(f.core),c=b,p=(h,a)=>{const P=h.map(d=>s.getComponentDefinition(d)).map(d=>d==null?void 0:d.name);return`${P.slice(0,-1).join(", ")} ${P.length>1?a:""} ${P.at(-1)}`},o=m(()=>{const h=s.getContainableTypes(c.componentId);let a;return h.length<=Re&&(a=`You can add ${p(h,"and")} components`),a});return(h,a)=>(T(),X(ve,{class:"ChildlessPlaceholder","component-id":b.componentId,message:o.value},null,8,["component-id","message"]))}}),Ve=["draggable"],Le={class:"title"},We={class:"message"},qe=j({__name:"RenderError",props:{componentType:{type:String,required:!0},message:{type:String,required:!0},draggable:{type:Boolean,required:!1}},setup(b){const s=$(f.core),c=$(f.componentId),p=m(()=>s.getComponentById(c)),o=m(()=>{var a;return s.getComponentById((a=p.value)==null?void 0:a.parentId)}),h=m(()=>{var a;return((a=o.value)==null?void 0:a.type)==="blueprints_blueprint"});return(a,g)=>h.value?(T(),X(me,{key:0,draggable:!1})):(T(),L("div",{key:1,class:"RenderError",draggable:b.draggable},[v("div",Le,[v("h2",null,"Error rendering "+R(b.componentType),1)]),v("div",We,R(b.message),1)],8,Ve))}}),Fe={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(b){const s=$(f.core),c=$(f.builderManager),p=b.componentId,o=m(()=>s.getComponentById(p)),h=fe(o.value.type),a=b.instancePath,g=b.instanceData,{getEvaluatedFields:P,isComponentVisible:y}=ee(s),d=P(a),k=ge(s),B=m(()=>s.getComponents(p,{sortedByPosition:!0})),w=m(()=>!!c&&c.getMode()!="preview"),z=m(()=>{var t;return w.value&&!o.value.isCodeManaged&&o.value.type!=="root"&&o.value.type!=="blueprints_root"&&((t=K.value)==null?void 0:t.toolkit)!=="blueprints"}),W=(t,i)=>(t?s.getContainableTypes(t):["root","blueprints_root"]).includes(i),V=x(!1),e=()=>{if(!(B.value.length>0))return A(xe,{componentId:o.value.id})},n=(t,i=0,l)=>A(oe,{componentId:t,key:`${t}:${i}`,instancePath:[...a,{componentId:t,instanceNumber:i}],instanceData:[...g,x(null)],...l??{}}),r=t=>i=>{if(!W(p,i.type)&&t==="default")return!0;const _=s.getComponentDefinition(i.type).slot??"default";return _==="*"||_===t},u=(t=0,i="default",l=()=>!0,_=!1)=>{const S=C=>!w.value||_?[]:[A("div",{"data-writer-slot-of-id":p,"data-writer-position":C})],I=B.value.filter(r(i)).filter(l),D=I.filter(C=>!C.isCodeManaged).map(C=>n(C.id,t,{contextSlot:i})),F=I.filter(C=>C.isCodeManaged).map(C=>n(C.id,t,{contextSlot:i}));return[...S(0),...D.map((C,H)=>[C,S(H+1)]).flat(),...F]},M=Ae(a);E(f.evaluatedFields,d),E(f.componentId,p),E(f.isBeingEdited,w),E(f.isDisabled,V),E(f.instancePath,a),E(f.instanceData,g),E(f.renderProxiedComponent,n),E(f.getChildrenVNodes,u),E(f.flattenedInstancePath,M);const q={"data-writer-id":p,"data-writer-instance-path":M},K=m(()=>s.getComponentDefinition(o.value.type)),G=m(()=>{var t;return(t=K.value)==null?void 0:t.fields}),U=x(!1);O(()=>c==null?void 0:c.isComponentIdSelected(p),t=>{U.value=t},{immediate:!0});const ae=m(()=>Object.entries(G.value??{}).filter(([,t])=>t.category===ye.Style).reduce((t,[i])=>(t[i]=d[i].value,t),{}));O(ae,()=>{U.value=!1,k.track("ui_block_styles_updated")});const J=m(()=>B.value.length==0),re=m(()=>y(p,a)),ie=(t,i)=>{if((!t||!(t!=null&&t.startsWith("$goToPage_")))&&!i)return _=>{s.forwardEvent(_,a,!0)};if(t!=null&&t.startsWith("$goToPage_")){const _=t.substring(10);return S=>s.setActivePageFromKey(_)}return null},le=m(()=>{const t={};return Object.keys(K.value.events??{}).forEach(l=>{var I;const _=`on${l.charAt(0).toUpperCase()}${l.slice(1)}`,S=l===((I=o.value.binding)==null?void 0:I.eventType);t[_]=D=>{var C,H;S&&s.forwardEvent(D,a,!0);const F=((C=o.value.handlers)==null?void 0:C[l])??null;(H=ie(F,S))==null||H(D)}}),t}),ce=m(()=>{const t=G.value;if(!t)return;const i={};return Object.keys(t).forEach(l=>{t[l].applyStyleVariable&&d[l]&&(i[`--${l}`]=d[l].value)}),i}),de=m(()=>{const t="cssClasses",i=G.value;if(!i||!i[t]||!d[t])return;const l=String(d[t].value),_=l==null?void 0:l.split(" ").map(I=>I.trim()),S={};return _.forEach(I=>{S[I]=!0}),S}),ue=function(){return{class:{[`wf-type-${o.value.type}`]:!0,component:!0,childless:J.value,selected:U.value,disabled:V.value,beingEdited:w.value,...de.value},style:{...ce.value,...re.value?{}:{display:"none"}},...q,...V.value?[]:le.value,draggable:z.value}},pe=(t,i)=>w.value?A(qe,{...t,componentType:o.value.type,message:i}):A("div");return()=>{const t=w.value?e():void 0,i=({instanceNumber:_=0,slotName:S="default",componentFilter:I=()=>!0,positionlessSlot:D=!1})=>J.value?D?void 0:t:u(_,S,I,D),l=ue();return W(o.value.parentId,o.value.type)?A(h,l,{default:i}):pe(l,"Parent is not suitable for this component")}}},oe=Y(Fe,[["__scopeId","data-v-124b6008"]]),He={class:"counter"},Oe={class:"main"},je={class:"clearContainer"},ze={class:"content"},Ke={class:"title"},Ge={class:"time"},Ue={class:"message"},Xe=100,Ye=j({__name:"RendererNotifications",setup(b){const s=$(f.core),c=x(!1),p=_e("balloon"),o=he([]),h=P=>{const{type:y,title:d,message:k,code:B}=P;o.unshift({type:y,title:d,message:k,code:B,timestampReceived:new Date}),o.splice(Xe),p.value.classList.remove("alert"),p.value.offsetWidth,p.value.classList.add("alert")};te(()=>{s.addMailSubscription("notification",h)});const a=()=>{o.length!=0&&(c.value=!c.value)},g=()=>{o.splice(0),c.value=!1};return(P,y)=>N((T(),L("div",{class:"RendererNotifications colorTransformer",onClick:a},[v("div",{ref_key:"balloon",ref:p,class:"balloon",title:"Toggle notifications"},[y[0]||(y[0]=v("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),v("div",He,R(o.length),1)],512),y[3]||(y[3]=v("div",{class:"balloonFlash"},null,-1)),N(v("div",Oe,[v("div",je,[ne(Se,{onClick:g},{default:Ce(()=>y[1]||(y[1]=[v("i",{class:"material-symbols-outlined"}," clear_all ",-1),be(" Clear all ")])),_:1})]),(T(!0),L(Ie,null,Pe(o,(d,k)=>(T(),L("div",{key:k,class:"notification"},[v("div",{class:se(["icon",d.type])},y[2]||(y[2]=[v("i",{class:"material-symbols-outlined"}," exclamation ",-1)]),2),v("div",ze,[v("header",null,[v("strong",Ke,R(d.title),1),v("span",Ge,R(d.timestampReceived.toLocaleTimeString()),1)]),v("div",Ue,R(d.message),1)])]))),128))],512),[[Q,c.value]])],512)),[[Q,o.length>0]])}}),Je=Y(Ye,[["__scopeId","data-v-0ffb1f63"]]),Ne={class:"rootComponentArea"},Qe=j({__name:"ComponentRenderer",setup(b){const s=$(f.core),c=$(f.builderManager),p=ee(s),o={},h=x({}),a=m(()=>(c==null?void 0:c.activeRootId.value)??"root");O(a,(e,n)=>{var u;h.value[n]=s.activePageId;const r=(u=h.value)==null?void 0:u[e];r&&s.setActivePageId(r)});const g=p.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),P=m(()=>{var e,n,r,u,M,q;return{...Ee,"--accentColor":(e=g.accentColor)==null?void 0:e.value,"--emptinessColor":(n=g.emptinessColor)==null?void 0:n.value,"--containerBackgroundColor":(r=g.parentIdBackgroundColor)==null?void 0:r.value,"--primaryTextColor":(u=g.primaryTextColor)==null?void 0:u.value,"--secondaryTextColor":(M=g.secondaryTextColor)==null?void 0:M.value,"--separatorColor":(q=g.separatorColor)==null?void 0:q.value}}),y=m(()=>s.frontendMessageMap.value.size>0);O(()=>{var e;return(e=g.appName)==null?void 0:e.value},e=>{e!=""&&d(e)},{immediate:!0});function d(e){const n=s.mode.value;let r;e&&n=="edit"?r=`${e} | Writer | Builder`:!e&&n=="edit"?r="Writer | Builder":e&&n=="run"?r=`${e}`:!e&&n=="run"&&(r="Writer"),document.title=r}async function k(e,n){const r=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);r==null||r.remove();const u=document.createElement("link");u.dataset.writerStylesheetKey=e,u.setAttribute("href",n),u.setAttribute("rel","stylesheet"),document.head.appendChild(u)}async function B(e,n){const r=document.querySelector(`[data-writer-script-key="${e}"]`);r==null||r.remove();const u=document.createElement("script");u.dataset.writerScriptKey=e,u.src=n,u.setAttribute("rel","modulepreload"),document.head.appendChild(u)}async function w(e,n){o[e]=n,await Z(()=>import(n),[],import.meta.url)}async function z(e,n,r){const u=o[e],M=await Z(()=>import(u),[],import.meta.url);if(!M){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}M[n](...r)}function W(){s.addMailSubscription("fileDownload",e=>{const n=document.createElement("a");n.href=e.data,n.download=e.fileName,n.click()}),s.addMailSubscription("openUrl",e=>{const n=document.createElement("a");n.href=e,n.target="_blank",n.rel="noopener noreferrer",n.click()}),s.addMailSubscription("pageChange",async e=>{(c==null?void 0:c.getMode())==="blueprints"&&c.setMode("ui"),await $e(),ke(e),s.setActivePageFromKey(e)}),s.addMailSubscription("routeVarsChange",e=>{Be(e)}),s.addMailSubscription("importStylesheet",({stylesheetKey:e,path:n})=>{k(e,n)}),s.addMailSubscription("importScript",({scriptKey:e,path:n})=>{B(e,n)}),s.addMailSubscription("importModule",({moduleKey:e,specifier:n})=>{w(e,n)}),s.addMailSubscription("functionCall",({moduleKey:e,functionName:n,args:r})=>{z(e,n,r)})}function V(){const e=De(),n=new CustomEvent("wf-app-open",{detail:{payload:e}}),r={componentId:"root",instanceNumber:0};s.forwardEvent(n,[r],!0)}return we(()=>{W()}),te(()=>{V()}),(e,n)=>(T(),L("main",{class:se(["ComponentRenderer",{loadingActive:y.value}]),tabindex:"-1",style:Te(P.value)},[ne(Je,{class:"notifications"}),n[0]||(n[0]=v("div",{class:"loadingBar"},null,-1)),v("div",Ne,[(T(),X(oe,{key:a.value,"component-id":a.value,"instance-path":[{componentId:a.value,instanceNumber:0}],"instance-data":[x(null)]},null,8,["component-id","instance-path","instance-data"])),Me(e.$slots,"default",{},void 0,!0)])],6))}}),tt=Y(Qe,[["__scopeId","data-v-f6c53567"]]);export{tt as default};
