import{d as N,i as k,a as S,c,o as v,e as B,G as x,f as a,s as _,N as l,ae as C,ay as P,X as j,_ as L,u as J,aY as U,x as H,W as O,t as X,z as F,A as K,b as Y,ai as Q}from"./index-ChWW_c_j.js";import{u as Z,W as G,b as V}from"./BuilderApp-0XXiQ2l7.js";import{a as ee}from"./useBlueprintRun-CBOvzWTA.js";import"./marked.esm-273vDTCT.js";const te={class:"BuilderBlueprintState"},ne=N({__name:"BuilderBlueprintState",props:{blueprintId:{type:String,required:!0}},setup(f){const r=f,d=k(S.core),n=k(S.builderManager),y=c(()=>d.getComponents(r.blueprintId)),b=c(()=>y.value.map(o=>o.id)),p=c(()=>{var m,I,h;const s=(m=n.getLogEntries().filter(w=>w.blueprintExecution?w.blueprintExecution.summary.some(E=>b.value.includes(E.componentId)):!1).at(0))==null?void 0:m.blueprintExecution.summary.at(-1);if(!s)return;if(s.outcome==="in_progress")return"in_progress";const u=d.getComponentById(s.componentId);return((h=(I=d.getComponentDefinition(u.type).outs)==null?void 0:I[s.outcome])==null?void 0:h.style)??"success"});return(o,s)=>(v(),B("div",te,[p.value?p.value==="success"?x(o.$slots,"success",{key:1},()=>[s[0]||(s[0]=a("span",{class:"BuilderBlueprintState__status BuilderBlueprintState__status--success material-symbols-outlined"},"check",-1))],!0):p.value==="error"?x(o.$slots,"error",{key:2},()=>[s[1]||(s[1]=a("span",{class:"BuilderBlueprintState__status BuilderBlueprintState__status--error material-symbols-outlined"},"error",-1))],!0):p.value==="in_progress"?x(o.$slots,"running",{key:3},()=>[_(P,{class:"BuilderBlueprintState__status",color:l(C).Gray5},null,8,["color"])],!0):j("",!0):x(o.$slots,"unknown",{key:0},void 0,!0)]))}}),se=L(ne,[["__scopeId","data-v-1d213169"]]),ie=["aria-busy"],re={class:"BuilderSettingsHandlersBlueprint__title"},oe=["data-writer-tooltip"],le={class:"BuilderSettingsHandlersBlueprint__list"},ae={class:"BuilderSettingsHandlersBlueprint__list__item"},ue={class:"BuilderSettingsHandlersBlueprint__list__item"},de=N({__name:"BuilderSettingsHandlersBlueprint",props:{component:{type:Object,required:!0},eventType:{type:String,required:!0},eventDescription:{type:String,required:!1,default:void 0}},setup(f){const r=k(S.core),d=k(S.builderManager),n=f,y=J(r),{createAndInsertComponent:b,removeComponentsSubtree:p}=Q(r,d,y),o=c(()=>n.eventType.replace(/^wf-/,"").replaceAll("-"," ")),{blueprints:s,triggers:u}=U(r,c(()=>n.component.id),c(()=>n.eventType)),{run:R,isRunning:m}=ee(r,c(()=>u.value.map(e=>({blueprintId:e.parentId,branchId:e.id})))),{pushToast:I}=Z();function h(){const e=s.value.map(t=>{const i=(t.content.key??"0").match(/\d+/);return i?Number(i[0]):0});return e.length===0?1:Math.max(...e)+1}async function w(){var z;const{type:e}=n.component,{name:t,events:i}=r.getComponentDefinition(e),T=`${t} - ${n.eventType}`,D=`${e}@${n.eventType.replace(/^wf-/,"")}_${h()}`;let g=(z=i==null?void 0:i[n.eventType])==null?void 0:z.eventPayloadExample;typeof g=="object"&&g!==null&&(g=JSON.stringify(g));const q=b("blueprints_blueprint","blueprints_root",void 0,{content:{key:D}},$=>{b("blueprints_uieventtrigger",$,void 0,{content:{alias:T,refComponentId:n.component.id,refEventType:n.eventType,defaultResult:g?String(g):void 0},x:96,y:96})});I({type:"success",message:`${T} added`,action:{label:"Go to blueprint",func:()=>{var $;return M(q,($=A(q))==null?void 0:$.id)},icon:"linked_services"}})}function A(e){return r.getComponents(e).find(t=>t.type==="blueprints_uieventtrigger"&&t.content.refComponentId===n.component.id&&t.content.refEventType===n.eventType)}function E(e){const t=[e.id];r.getComponents(e.parentId).length===1&&t.push(e.parentId),p(...t)}function W(e){var t,i;return((i=(t=r.getComponentById(e.parentId))==null?void 0:t.content)==null?void 0:i.key)||"Blueprint"}function M(e,t){r.setActivePageId(e),d.setMode("blueprints"),d.setSelection(t??e,void 0,"click")}return(e,t)=>(v(),B("div",{class:"BuilderSettingsHandlersBlueprint","aria-busy":l(m)},[a("div",re,[_(O,{class:"BuilderSettingsHandlersBlueprint__title__btn",variant:"special",size:"icon","aria-label":"Run the attached blueprints",disabled:l(m),loading:l(m),onClick:l(R)},{default:H(()=>t[0]||(t[0]=[a("i",{class:"material-symbols-outlined"},"play_arrow",-1)])),_:1},8,["disabled","loading","onClick"]),a("p",null,X(o.value),1),f.eventDescription?(v(),B("span",{key:0,"data-writer-tooltip":f.eventDescription,class:"material-symbols-outlined"},"help",8,oe)):j("",!0)]),a("div",le,[(v(!0),B(F,null,K(l(u),(i,T)=>(v(),Y(V,{key:i.id,color:l(C).Blue6,"color-last":l(u).length===T+1?l(C).Blue2:l(C).Blue6},{default:H(()=>[a("div",ae,[_(G,{variant:"secondary",disabled:l(m),text:W(i),"data-writer-tooltip":W(i),"data-writer-tooltip-strategy":"overflow",onClick:D=>M(i.parentId,i.id)},null,8,["disabled","text","data-writer-tooltip","onClick"]),_(se,{"blueprint-id":i.parentId},null,8,["blueprint-id"]),_(O,{variant:"neutral",size:"smallIcon","custom-size":"18px","aria-label":"Unlink blueprint","data-writer-tooltip":"This will remove the trigger but will not delete the blueprint",disabled:l(m),onClick:D=>E(i)},{default:H(()=>t[1]||(t[1]=[a("i",{class:"material-symbols-outlined"},"link_off",-1)])),_:2},1032,["disabled","onClick"])])]),_:2},1032,["color","color-last"]))),128)),_(V,{"is-last":"",color:l(C).Blue2},{default:H(()=>[a("div",ue,[_(G,{variant:"primary",weight:"semibold",disabled:l(m),"left-icon":"add",text:"Create blueprint",onClick:w},null,8,["disabled"])])]),_:1},8,["color"])])],8,ie))}}),ce=L(de,[["__scopeId","data-v-f9b5fecc"]]),pe={key:0,class:"BuilderSettingsHandlers"},me={class:"BuilderSettingsHandlers__list"},_e=N({__name:"BuilderSettingsHandlers",setup(f){const r=k(S.core),d=k(S.builderManager),n=c(()=>r.getComponentById(d.firstSelectedId.value)),y=c(()=>{const{type:p}=n.value,{events:o}=r.getComponentDefinition(p),s={...o};return Object.keys({...n.value.handlers}).forEach(u=>{s[u]||(s[u]={desc:"Custom event"})}),s}),b=c(()=>d.isSingleSelectionActive.value?Object.keys(y.value).length>0:!1);return(p,o)=>b.value?(v(),B("div",pe,[o[0]||(o[0]=a("div",{class:"BuilderSettingsHandlers__title"},[a("i",{class:"material-symbols-outlined"},"linked_services"),a("h3",null,"Blueprints")],-1)),a("div",me,[(v(!0),B(F,null,K(y.value,(s,u)=>(v(),B("div",{key:u},[_(ce,{component:n.value,"event-type":u,"event-description":s.desc},null,8,["component","event-type","event-description"])]))),128))])])):j("",!0)}}),be=L(_e,[["__scopeId","data-v-d3a42325"]]);export{be as default};
