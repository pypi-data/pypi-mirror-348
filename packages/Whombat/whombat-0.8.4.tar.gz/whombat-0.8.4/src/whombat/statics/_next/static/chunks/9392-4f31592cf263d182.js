"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9392],{2588:function(n,e,t){t.d(e,{Z:function(){return s}});var o=t(57437),l=t(11164),r=t(14759),a=t(18133),i=t(79239);function s(n){let{soundEvent:e,...t}=n,s=(0,r.Z)(n=>n.getTagColor),{data:u,addTag:c,removeTag:d}=(0,l.Z)({uuid:e.uuid,soundEventAnnotation:e,onAddTag:t.onAddTag,onRemoveTag:t.onRemoveTag});return(0,o.jsx)(a.lR,{soundEvent:u||e,...t,tagColorFn:s,onAddTag:c.mutate,onRemoveTag:d.mutate,TagSearchBar:i.Z})}},79239:function(n,e,t){t.d(e,{Z:function(){return s}});var o=t(57437),l=t(2265),r=t(72288),a=t(65198),i=t(34657);function s(n){let{onCreateTag:e,...t}=n,s=(0,l.useContext)(a.Z),{data:u,addTag:c}=(0,r.Z)({uuid:s.uuid,annotationProject:s}),d=(0,l.useMemo)(()=>({annotation_project:u||s}),[u,s]),f=(0,l.useCallback)(n=>{c.mutate(n),null==e||e(n)},[c,e]);return(0,o.jsx)(i.Z,{onCreateTag:f,filter:d,fixed:["annotation_project"],...t})}},65198:function(n,e,t){let o=(0,t(2265).createContext)({name:"",description:"",tags:[],created_on:new Date,uuid:""});e.Z=o},72288:function(n,e,t){t.d(e,{Z:function(){return s}});var o=t(21770),l=t(2265),r=t(69064),a=t(23857),i=t(58435);function s(n){let{uuid:e,annotationProject:t,onUpdate:s,onDelete:u,onAddTag:c,onRemoveTag:d,onAddAnnotationTasks:f,onError:v,enabled:h=!0}=n,{query:g,useMutation:p,client:m}=(0,i.ZP)({id:e,initialData:t,name:"annotation_project",enabled:h,queryFn:a.Z.annotationProjects.get,onError:v}),b=p({mutationFn:a.Z.annotationProjects.update,onSuccess:n=>{r.ZP.success("Annotation project updated"),null==s||s(n)}}),x=p({mutationFn:a.Z.annotationProjects.addTag,onSuccess:c}),y=p({mutationFn:a.Z.annotationProjects.removeTag,onSuccess:d}),Z=p({mutationFn:a.Z.annotationProjects.delete,onSuccess:u}),{data:k}=g,w=(0,l.useCallback)(async n=>{if(null==k)return;let e=await a.Z.clips.createMany(n);return await a.Z.annotationTasks.createMany(k,e)},[k]),j=(0,o.D)({mutationFn:w,onSuccess:n=>{null!=n&&(null==f||f(n),m.invalidateQueries({queryKey:["annotation_project",e]}))}}),C=(0,l.useCallback)(async()=>{await r.ZP.promise(a.Z.annotationProjects.download(e),{loading:"Downloading...",success:"Download complete",error:"Failed to download dataset"})},[e]);return{...g,update:b,addTag:x,addAnnotationTasks:j,removeTag:y,delete:Z,download:C}}},11164:function(n,e,t){t.d(e,{Z:function(){return i}});var o=t(21770),l=t(2265),r=t(23857),a=t(58435);function i(n){let{uuid:e,soundEventAnnotation:t,clipAnnotation:i,onDelete:s,onUpdate:u,onAddTag:c,onRemoveTag:d,onAddNote:f,onError:v,enabled:h=!0,withRecording:g=!1}=n,{query:p,useQuery:m,useMutation:b,useDestruction:x,client:y}=(0,a.ZP)({name:"sound_event_annotation",id:e,initialData:t,enabled:h,queryFn:r.Z.soundEventAnnotations.get,onError:v}),Z=m({secondaryName:"recording",queryFn:(0,l.useMemo)(()=>g?()=>{if(null==p.data)throw Error("Cannot get recording for sound event annotation without recording");return r.Z.soundEvents.getRecording(p.data.sound_event)}:()=>{throw Error("Cannot get recording for sound event annotation without recording")},[p.data,g]),enabled:g&&null!=p.data}),k=(0,l.useCallback)(n=>{null!=i&&y.setQueryData(["clip_annotation",i.uuid],e=>{var t;if(null!=e)return{...e,sound_events:null===(t=e.sound_events)||void 0===t?void 0:t.map(e=>e.uuid===n.uuid?n:e)}})},[y,i]),w=(0,l.useCallback)(n=>{null==u||u(n),k(n)},[u,k]),j=b({mutationFn:r.Z.soundEventAnnotations.update,onSuccess:w}),C=(0,l.useCallback)(n=>{null==s||s(n),k(n)},[s,k]),T=x({mutationFn:r.Z.soundEventAnnotations.delete,onSuccess:C}),A=(0,l.useCallback)((n,e)=>{null==c||c(e),k(n)},[c,k]),P=b({mutationFn:r.Z.soundEventAnnotations.addTag,onSuccess:A}),E=(0,l.useCallback)((n,e)=>{null==d||d(e),k(n)},[d,k]),F=b({mutationFn:r.Z.soundEventAnnotations.removeTag,onSuccess:E}),S=(0,l.useCallback)((n,e)=>{null==f||f(e),k(n)},[f,k]),N=b({mutationFn:r.Z.soundEventAnnotations.addNote,onSuccess:S}),_=(0,o.D)({mutationFn:n=>{let{note:e,data:t}=n;return r.Z.notes.update(e,t)},onSuccess:()=>{p.refetch()}}),D=b({mutationFn:r.Z.soundEventAnnotations.removeNote});return{...p,update:j,delete:T,addTag:P,removeTag:F,addNote:N,updateNote:_,removeNote:D,recording:Z}}},57887:function(n,e,t){var o=t(57437),l=t(2265),r=t(27432);let a=(0,l.memo)(function(n){return(0,o.jsxs)(r.Z,{className:"w-full",children:[(0,o.jsxs)("div",{className:"flex flex-row gap-4",children:[n.ViewportToolbar,n.AnnotationControls,n.Player,n.SettingsMenu]}),n.Canvas,n.ViewportBar,n.SelectedSoundEvent]})});e.Z=a},18133:function(n,e,t){t.d(e,{ZP:function(){return f},lR:function(){return v}});var o=t(57437),l=t(36760),r=t.n(l),a=t(2265),i=t(31476),s=t(44317),u=t(43289),c=t(65781),d=t(54259);function f(n){let{children:e,soundEvents:t,viewport:l,SoundEventTags:r=v,...i}=n,{size:c,ref:d}=(0,s.Z)(),f=(0,a.useMemo)(()=>t.filter(n=>(0,u.PT)(n.sound_event.geometry,l)),[t,l]);return(0,o.jsxs)("div",{className:"relative w-full h-full rounded",ref:d,children:[e,f.map(n=>(0,o.jsx)(r,{viewport:l,soundEvent:n,dimensions:c,...i},n.uuid))]})}function v(n){var e;let{soundEvent:t,viewport:l,dimensions:a,enabled:i=!0,tagColorFn:s=c.vm,onRemoveTag:u,onAddTag:f,...v}=n,{x:g,y:p}=(0,c.DI)(t,l,a);return(0,o.jsxs)("div",{className:r()("h-5 flex flex-col absolute px-2 text-stone-300 hover:z-50 z-40"),style:{left:g,top:p},children:[(0,o.jsx)("div",{className:"flex relative right-0 flex-col hover:gap-2 -ms-2",children:null===(e=t.tags)||void 0===e?void 0:e.map(n=>(0,o.jsx)(h,{disabled:!i,tagColorFn:s,onClick:()=>null==u?void 0:u(n),tag:n},(0,c.ix)(n)))}),i&&(0,o.jsx)(d.Z,{onSelectTag:f,...v})]})}function h(n){let{tag:e,onClick:t,tagColorFn:l=c.vm,disabled:r=!1}=n,s=l(e),u=(0,a.useMemo)(()=>"bg-".concat(s.color,"-500"),[s]);return(0,o.jsxs)("span",{className:"flex flex-row gap-1 items-center px-2 -my-2 rounded-full transition-all group bg-stone-200/0 dark:bg-stone-800/0 hover:bg-stone-200 hover:dark:bg-stone-800",children:[(0,o.jsx)("span",{className:"inline-block my-2 w-2 h-2 rounded-full ".concat(u," ring-1 ring-stone-900 opacity-100")}),(0,o.jsxs)("button",{type:"button",className:"hidden flex-row gap-1 items-center opacity-0 transition-all group-hover:flex group-hover:opacity-100 hover:text-red-500 text-stone-800 dark:text-stone-400",onClick:t,children:[(0,o.jsx)("span",{className:"hidden text-xs font-thin whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:e.key}),(0,o.jsx)("span",{className:"hidden text-sm font-medium whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:e.value}),!r&&(0,o.jsx)(i.Tw,{className:"inline-block w-3 h-3 stroke-2"})]})]})}},54259:function(n,e,t){var o=t(57437),l=t(97051),r=t(62756),a=t(2265),i=t(31476),s=t(4987),u=t(80207);let c=(0,a.memo)(function(n){let{text:e="add",variant:t="secondary",placement:a="bottom-start",onKeyDown:c,TagSearchBar:d=s.Z,...f}=n;return(0,o.jsx)(r.J,{as:"div",className:"inline-block text-left",children:(0,o.jsxs)(l.bv,{zIndex:20,placement:a,offset:4,enter:"transition duration-200 ease-out",enterFrom:"scale-95 opacity-0",enterTo:"scale-100 opacity-100",leave:"transition duration-150 ease-in",leaveFrom:"scale-100 opacity-100",leaveTo:"scale-95 opacity-0",portal:!0,children:[(0,o.jsx)(r.J.Button,{as:"div",children:(0,o.jsxs)(u.Z,{mode:"text",variant:t,padding:"py-1",children:[(0,o.jsx)(i.dt,{className:"inline-block w-5 h-5 align-middle"}),e]})}),(0,o.jsx)(r.J.Panel,{className:"w-72",focus:!0,children:n=>{let{close:e}=n;return(0,o.jsx)(d,{onKeyDown:n=>{if("Escape"===n.key){e();return}null==c||c(n)},...f})}})]})})});e.Z=c},55047:function(n,e,t){t.d(e,{Z:function(){return r}});var o=t(57437),l=t(83470);function r(){let{text:n=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.jsxs)("div",{className:"flex flex-row justify-center items-center w-full h-full",children:[(0,o.jsx)(l.Z,{})," ",n]})}},4523:function(n,e,t){t.d(e,{Z:function(){return c}});var o=t(99730),l=t(42437),r=t(76168),a=t(2676);let i={fillColor:"red",fillAlpha:1,radius:4};function s(n,e){var t,o,l,r;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;if((null!==(t=a.fillAlpha)&&void 0!==t?t:1)!==0){let{coordinates:t}=e,[i,s]=t;n.fillStyle=null!==(o=a.fillColor)&&void 0!==o?o:"red",n.globalAlpha=null!==(l=a.fillAlpha)&&void 0!==l?l:1,n.beginPath(),n.arc(i,s,null!==(r=a.radius)&&void 0!==r?r:4,0,2*Math.PI,!0),n.fill()}}var u=t(25200);function c(n,e,t){let{type:c}=e;switch(c){case"TimeStamp":(0,a.Z)(n,e.coordinates,t);break;case"TimeInterval":let[d,f]=e.coordinates;(0,l.Z)(n,{min:d,max:f},t);break;case"BoundingBox":(0,o.Z)(n,e.coordinates,t);break;case"Point":s(n,e,t);break;case"MultiPoint":!function(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,{coordinates:o}=e;o.forEach(e=>{s(n,{type:"Point",coordinates:e},t)})}(n,e,t);break;case"LineString":(0,r.s6)(n,e,t);break;case"MultiLineString":(0,r.F$)(n,e,t);break;case"Polygon":(0,u.is)(n,e,t);break;case"MultiPolygon":(0,u.$W)(n,e,t);break;default:console.error("Cannot draw unknown geometry type ".concat(c))}}},42437:function(n,e,t){t.d(e,{X:function(){return l},Z:function(){return r}});var o=t(50639);let l={fillColor:"red",fillAlpha:.5,borderWidth:1,borderAlpha:1};function r(n,e){var t,r;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l,{canvas:i}=n,{height:s}=i,{min:u,max:c}=e;(null!==(t=a.borderAlpha)&&void 0!==t?t:1)!==0&&((0,o.F6)(n,a),n.beginPath(),n.moveTo(u,0),n.lineTo(u,s),n.stroke(),n.beginPath(),n.moveTo(c,0),n.lineTo(c,s),n.stroke()),(null!==(r=a.fillAlpha)&&void 0!==r?r:.5)!==0&&((0,o.wi)(n,a),n.fillRect(u,0,c-u,s))}},76168:function(n,e,t){t.d(e,{F$:function(){return a},nK:function(){return l},s6:function(){return r}});var o=t(50639);let l={borderColor:"red",borderWidth:2,borderAlpha:1};function r(n,e){var t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l;if((null!==(t=r.borderAlpha)&&void 0!==t?t:1)!==0){let{coordinates:t}=e;if(t.length<2)return;(0,o.F6)(n,r),n.beginPath();let[l,a]=t[0];n.moveTo(l,a),t.slice(1).forEach(e=>{let[t,o]=e;n.lineTo(t,o)}),n.stroke()}}function a(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l,{coordinates:o}=e;o.forEach(e=>{r(n,{type:"LineString",coordinates:e},t)})}},25200:function(n,e,t){t.d(e,{$W:function(){return a},is:function(){return r}});let o={borderColor:"red",borderWidth:1,borderAlpha:1,fillAlpha:.5,fillColor:"red"};function l(n,e){if(e.length<2){console.error("Invalid linering. Needs at least two points");return}let[t,o]=e[0];n.moveTo(t,o),e.slice(1).forEach(e=>{let[t,o]=e;return n.lineTo(t,o)}),n.lineTo(t,o)}function r(n,e){var t,r,a,i,s,u;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,{coordinates:d}=e;if(0===d.length){console.error("Polygon has no exterior ring");return}let f=d[0];if(f.length<2){console.error("Invalid exterior ring for polygon");return}let[v,h]=f[0];n.beginPath(),l(n,f),d.slice(1).forEach(e=>{if(e.length<2){console.error("Invalid interior ring for polygon");return}l(n,e),n.moveTo(v,h)}),n.closePath(),n.fillStyle=null!==(r=null!==(t=c.fillColor)&&void 0!==t?t:c.borderColor)&&void 0!==r?r:"red",n.globalAlpha=null!==(a=c.fillAlpha)&&void 0!==a?a:1,n.fill("evenodd"),n.strokeStyle=null!==(i=c.borderColor)&&void 0!==i?i:"red",n.lineWidth=null!==(s=c.borderWidth)&&void 0!==s?s:1,n.globalAlpha=null!==(u=c.borderAlpha)&&void 0!==u?u:1,c.borderDash&&n.setLineDash(c.borderDash),n.stroke()}function a(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,{coordinates:l}=e;l.forEach(e=>{r(n,{type:"Polygon",coordinates:e},t)})}},64063:function(n,e,t){t.d(e,{Z:function(){return s}});var o=t(2265),l=t(4523),r=t(50639),a=t(43289);let i={borderColor:r.Ej,fillColor:r.Ej,borderWidth:2,fillAlpha:.1};function s(n){let{viewport:e,soundEvents:t}=n;return(0,o.useCallback)(n=>{for(let o of t){let t=(0,a.w9)({width:n.canvas.width,height:n.canvas.height},o.sound_event.geometry,e);(0,l.Z)(n,t,i)}},[e,t])}}}]);