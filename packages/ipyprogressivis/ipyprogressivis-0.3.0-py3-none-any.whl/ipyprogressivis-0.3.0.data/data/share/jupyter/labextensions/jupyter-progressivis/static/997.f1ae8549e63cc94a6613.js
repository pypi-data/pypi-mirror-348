"use strict";(self.webpackChunkjupyter_progressivis=self.webpackChunkjupyter_progressivis||[]).push([[997],{2997:(e,t,s)=>{s.r(t),s.d(t,{default:()=>_,progressivisPlugin:()=>h});var o=s(3906),a=s(5263),d=s(3563),i=s(4692),r=s.n(i);function l(e,t){let s=[];e.shell._rightHandler._items.forEach((function(e){"Widgets Output"!=e.widget.title._label&&"Modules Output"!=e.widget.title._label||s.push(e.widget)})),s.forEach((function(e){e.close()}));var o=t.currentWidget.content;let a=[];o.widgets.forEach((function(e){console.log("meta",e.model.sharedModel.metadata),console.log("ptag",e.model.sharedModel.metadata.progressivis_tag),null!=e.model.sharedModel.metadata.progressivis_tag&&(e.model.sharedModel.setMetadata("deletable",!0),e.model.sharedModel.setMetadata("editable",!0),a.push(e))})),console.log("toDelete",a);for(let e of a){let t=o.widgets.findIndex((t=>t==e));o.model.sharedModel.deleteCell(t)}}function n(e){var t=e.currentWidget.content;t.widgets.forEach((function(s){if(s.model.sharedModel.source.startsWith("# progressivis-snippet")){let o=t.widgets.findIndex((e=>e==s));c(e,o)}}))}function c(e,t){var s=e.currentWidget,o=s.content;o.activeCellIndex=t,a.NotebookActions.run(o,s.sessionContext)}function g(e,t,s,o){let a=e.model.metadata.progressivis_outs||[];setTimeout((function(){let o=r()(t.outputArea.node).find(r()(".progressivis_guest_widget")).first()[0];void 0!==o&&d.toPng(o).then((t=>{a[s]=t,e.model.sharedModel.setMetadata("progressivis_outs",a)}))}),o),setTimeout((function(){d.toPng(r()("[id^='dag_widget_']")[0]).then((t=>{e.model.sharedModel.setMetadata("progressivis_dag_png",t)}))}),o)}window.$=r(),window.html_to_image=d;var m=s(3266),u=s(8801),p=s(498),v=s(3997);const h={id:"jupyter-progressivis:plugin",requires:[u.IJupyterWidgetRegistry,a.INotebookTracker,p.IFileBrowserFactory],activate:function(e,t,s,d){window.ProgressiVis={frontend:()=>e,nbtracker:()=>s,nbactions:a.NotebookActions},(0,v.request)("get",`${m.PageConfig.getBaseUrl()}progressivis/template`).then((t=>{if(t.ok){const s=t.json();e.commands.addCommand("progressivis:templ",{label:"New ProgressiBook",caption:"Initialize a notebook for progressivis chaining widgets usage",execute:()=>{!function(e,t,s,o){t.json();const{path:a}=o.tracker.currentWidget.model;new Promise((t=>{e.commands.execute("docmanager:new-untitled",{ext:"ipynb",path:a,type:"notebook"}).then((o=>{e.commands.execute("docmanager:open",{factory:"Notebook",path:o.path}).then((e=>{e.isUntitled=!0,e.context.ready.then((()=>{e.model.fromString(s.payload),t(e)}))}))}))}))}(e,t,s,d)}})}})),e.commands.addCommand("progressivis:pass",{label:"Progressivis pass",caption:"Progressivis pass",execute:()=>{console.log("progressivis pass")}}),e.commands.addCommand("progressivis:args",{label:"Progressivis args",caption:"Progressivis args",execute:e=>{console.log("progressivis args:",e)}}),e.commands.addCommand("progressivis:set_cell_meta",{label:"Progressivis set cell meta",caption:"Progressivis set cell meta",execute:e=>{!function(e,t,s,o){var a=e.currentWidget.content.widgets[t];console.log("set cell meta",a.model.metadata,s,o),a.model.sharedModel.setMetadata(s,o)}(s,e.i,e.key,e.value)}}),e.commands.addCommand("progressivis:set_backup",{label:"Progressivis set backup",caption:"Progressivis set backup",execute:e=>{!function(e,t){var s=e.currentWidget.content.widgets[0];console.log("backup cell",s.model.metadata,t),s.model.sharedModel.setMetadata("progressivis_backup",t)}(s,e.backup)}}),e.commands.addCommand("progressivis:set_root_backup",{label:"Progressivis set root backup",caption:"Progressivis set root backup",execute:e=>{!function(e,t){var s=e.currentWidget.content.widgets[0];console.log("backup root markdown",s.model.metadata,t),s.model.sharedModel.setMetadata("progressivis_root_backup",t)}(s,e.backup)}}),e.commands.addCommand("progressivis:cleanup",{label:"Cleanup sidecars and tagged cells",caption:"Cleanup orphan sidecars and tagged cells",execute:()=>{l(e,s)}}),e.commands.addCommand("progressivis:cleanup_and_run",{label:"Cleanup and run",caption:"Cleanup and run",execute:t=>{void 0===s.currentWidget.progressivis_started?(r()(".progressivis-cleanup-and-run-btn").hide(),s.currentWidget.progressivis_started=!0,l(e,s),c(s,t.index),n(s)):alert("ProgressiVis is already running!")}}),e.commands.addCommand("progressivis:run_cell_at",{label:"Run cell at index",caption:"Run cell at index",execute:e=>{c(s,e.index)}}),e.commands.addCommand("progressivis:run_all_snippet_cells",{label:"Run snippet cells",caption:"Run snippet cells",execute:()=>{n(s)}}),e.commands.addCommand("progressivis:remove_tagged_cells",{label:"Remove tagged cells",caption:"Remove tagged cells",execute:e=>{!function(e,t){t=t.toString();var s=e.currentWidget.content;let o=[];s.widgets.forEach((function(e){e.model.metadata.progressivis_tag===t&&(e.model.sharedModel.setMetadata("deletable",!0),e.model.sharedModel.setMetadata("editable",!0),o.push(e))}));for(let e of o){let t=s.widgets.findIndex((t=>t==e));s.model.sharedModel.transact((()=>{s.model.sharedModel.deleteCell(t)}))}}(s,e.tag)}}),e.commands.addCommand("progressivis:unlock_markdown_cells",{label:"Unlock markdown cells",caption:"Unlock markdown cells",execute:()=>{!function(e){e.currentWidget.content.widgets.forEach((function(e){void 0!==e.model.metadata.progressivis_tag&&"markdown"===e.model.sharedModel.cell_type&&e.model.sharedModel.setMetadata("editable",!0)}))}(s)}}),e.commands.addCommand("progressivis:create_stage_cells",{label:"Create stage cells",caption:"Create stage cells",execute:e=>{!function(e,t,s,o,d,i){var r=e.currentWidget,l=r.content;t=t.toString();let n=-1;l.widgets.forEach((function(e){e.model.metadata.progressivis_tag===t&&(e.model.sharedModel.setMetadata("deletable",!0),e.model.sharedModel.setMetadata("editable",!0),l.widgets.findIndex((t=>t==e)))})),n<0?n=l.widgets.length:n+=1,l.model.sharedModel.insertCell(n,{cell_type:"markdown",source:s}),l.activeCellIndex=n;var c=l.widgets[n];a.NotebookActions.run(l,r.sessionContext),c.model.sharedModel.setMetadata("trusted",!0),c.model.sharedModel.setMetadata("editable",!0),c.model.sharedModel.setMetadata("deletable",!1),c.model.sharedModel.setMetadata("progressivis_tag",t),l.model.sharedModel.insertCell(n+1,{cell_type:"code",source:o}),l.activeCellIndex=n+1,c=l.widgets[n+1],i&&a.NotebookActions.run(l,r.sessionContext),c.model.sharedModel.setMetadata("trusted",!0),c.model.sharedModel.setMetadata("editable",d),c.model.sharedModel.setMetadata("deletable",!1),c.model.sharedModel.setMetadata("progressivis_tag",t)}(s,e.tag,e.md,e.code,e.rw,e.run)}}),e.commands.addCommand("progressivis:shot_cell",{label:"Shot cell",caption:"Shot cell",execute:e=>{!function(e,t,s){var o=e.currentWidget.content;let a=o.widgets.findIndex((e=>e.model.metadata.progressivis_tag===t&&"code"===e.model.sharedModel.cell_type));g(o,o.widgets[a],a,s)}(s,e.tag,e.delay)}}),a.NotebookActions.executed.connect(((e,t)=>{let{cell:s,notebook:o,success:a}=t,d=o.widgets.findIndex((e=>e==s));void 0!==s.model.metadata.progressivis_tag&&g(o,s,d,3e3)}));const i=class extends u.DOMWidgetView{render(){this.model.on("msg:custom",(t=>{console.log("messg:",t);let s={...t},o=s.cmd;delete s.cmd,console.log("exec cmd",o),e.commands.execute(o,s)}))}},p=class extends u.DOMWidgetView{render(){this.model.on("msg:custom",this.load_backup,this);var e=s.currentWidget.content.widgets[0];this.model.set("value",e.model.metadata.progressivis_backup||""),this.model.set("root_markdown",e.model.metadata.progressivis_root_backup||""),this.touch()}load_backup(e){var t=s.currentWidget.content,o=t.widgets[0];console.log("backup cell",o.model.metadata),this.model.set("value",o.model.metadata.progressivis_backup);let a=[];t.widgets.forEach((function(e){"markdown"===e.model.sharedModel.cell_type&&a.push(e.model.sharedModel.source)})),this.model.set("markdown",JSON.stringify(a)),this.touch()}},h=class extends u.DOMWidgetView{render(){this.el.innerHTML="<div></div>",this.tag_changed(),this.touch()}tag_changed(){console.log("tag changed",this.model.get("tag"));var e=s.currentWidget.content;let t=e.widgets.findIndex((e=>e.model.metadata.progressivis_tag===this.model.get("tag")&&"code"===e.model.sharedModel.cell_type));if(void 0===t)return;if(void 0===e.model.metadata.progressivis_prev_outs||e.model.metadata.progressivis_prev_outs.length<=t)return;let o=e.model.metadata.progressivis_prev_outs[t];this.el.innerHTML="<img src='"+o+"'></img>",this.touch()}};let _={...o};_.TalkerView=i,_.BackupView=p,_.CellOutView=h,t.registerWidget({name:"jupyter-progressivis",version:"0.1.0",exports:_})},autoStart:!0},_=h}}]);