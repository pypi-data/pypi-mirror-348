<style>body{font-family:Arial,sans-serif;padding:2rem;background:#222;color:#ddd}.completion{display:flex;flex-direction:row;flex-wrap:wrap;gap:.5rem}.stats{display:flex;flex-direction:row;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid #444}.token{display:inline-block;padding:.25rem .5rem;background:#333;border-radius:.25rem}</style><script>const elements={},tokenColors={},tokenStats={},handlers={"boost.listener.event":handleBoostEvent,"chat.completion.chunk":handleCompletionChunk};async function entrypoint(){window.__init||(window.__init=!0,main())}async function main(){const n=document.createElement("div");n.classList.add("stats"),document.body.appendChild(n),elements.stats=n;const t=document.createElement("div");t.classList.add("completion"),document.body.appendChild(t),elements.completion=t;const e=(await fetch("http://localhost:34131/events/<<listener_id>>",{headers:{Authorization:"Bearer sk-boost"}})).body.getReader();for(;;){const{done:n,value:t}=await e.read();if(n)break;try{const n=(new TextDecoder).decode(t).split("\n\n");for(const t of n)processChunk(t)}catch(n){console.error(n)}}}function processChunk(n){const t=JSON.parse(n.replace(/data: /,"")),e=t.object,o=handlers[e];o&&(console.log("Processing chunk:",t),o(t))}function handleCompletionChunk(n){const t=getChunkContent(n),e=tokenStats[t]||0;tokenStats[t]=e+1,renderToken(t),renderStats()}function handleBoostEvent(){}function getChunkContent(n){return n.choices.map((n=>n.delta.content)).join("\n")}function randomColor(){return"rgba("+[0,0,0].map((()=>Math.floor(128*Math.random())+64)).join(", ")+")"}function getTokenColor(n){return tokenColors[n]||(tokenColors[n]=randomColor()),tokenColors[n]}function renderToken(n){const t=document.createElement("div");t.classList.add("token"),t.innerHTML=n,t.style.backgroundColor=getTokenColor(n),t.style.opacity=1/tokenStats[n],elements.completion.appendChild(t)}function renderStats(){const n=elements.stats;n.innerHTML="";for(const[t,e]of Object.entries(tokenStats).sort(((n,t)=>t[1]-n[1]))){if(e<2)continue;if(1===t.trim().length)continue;const o=document.createElement("div");o.classList.add("token"),o.innerHTML=`${t}: ${e}`,n.appendChild(o)}}entrypoint().catch(console.error)</script>