"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["40908"],{55815:function(e,t,a){a.d(t,{Eu:()=>s,hZ:()=>l,o9:()=>n});var o=a(28105),i=a(45657);const r=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function s(e){return r[e%r.length]}function l(e,t){const a=t.getPropertyValue(`--graph-color-${e+1}`)||s(e);return(0,i.Rq)(a)}const n=(0,o.Z)((e=>r.map(((t,a)=>l(a,e)))),((e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")))},51574:function(e,t,a){a.d(t,{U:()=>o,W:()=>i});const o=(e,t)=>{const a=t.entities[e.entity_id];return a?i(a,t):{entity:null,device:null,area:null,floor:null}},i=(e,t)=>{const a=t.entities[e.entity_id],o=null==e?void 0:e.device_id,i=o?t.devices[o]:void 0,r=(null==e?void 0:e.area_id)||(null==i?void 0:i.area_id),s=r?t.areas[r]:void 0,l=null==s?void 0:s.floor_id;return{entity:a,device:i||null,area:s||null,floor:(l?t.floors[l]:void 0)||null}}},51676:function(e,t,a){a.a(e,(async function(e,t){try{a(26847),a(2394),a(44438),a(18574),a(81738),a(94814),a(29981),a(22960),a(6989),a(93190),a(87799),a(67886),a(65451),a(46015),a(38334),a(94880),a(75643),a(29761),a(27530);var o=a(73742),i=a(7616),r=a(59048),s=a(75976),l=a(28105),n=a(64346),d=a(3901),c=a(37008),u=a(28996),h=(a(12942),e([c,n]));[c,n]=h.then?(await h)():h;let _,f,v=e=>e;const p=5,g=12,b=8,y=5;class m extends r.oi{render(){var e;const t={grid:{top:0,bottom:0,left:0,right:0},tooltip:{trigger:"item",formatter:this._renderTooltip,appendTo:document.body}};return(0,r.dy)(_||(_=v`<ha-chart-base .data="${0}" .options="${0}" height="100%" .extraComponents="${0}"></ha-chart-base>`),this._createData(this.data,null===(e=this._sizeController.value)||void 0===e?void 0:e.width),t,[s.N])}_processLinks(e,t){const a=new Map,o=new Map,i=[];return t.forEach((t=>{var r;const s=e.find((e=>e.id===t.source)),l=e.find((e=>e.id===t.target));if(!s||!l)return;const n=o.get(s.id)||0,d=a.get(l.id)||0,c=s.value-n,u=l.value-d,h=Math.min(null!==(r=t.value)&&void 0!==r?r:c,c,u);a.set(l.id,d+h),o.set(s.id,n+h),h>0&&i.push(Object.assign(Object.assign({},t),{},{value:h}))})),i}constructor(...e){super(...e),this.data={nodes:[],links:[]},this.vertical=!1,this._sizeController=new n.Z(this,{callback:e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.contentRect}}),this._renderTooltip=e=>{const t=e.data,a=this.valueFormatter?this.valueFormatter(t.value):t.value;if(t.id){var o;const i=this.data.nodes.find((e=>e.id===t.id));return`${e.marker} ${null!==(o=null==i?void 0:i.label)&&void 0!==o?o:t.id}<br>${a}`}if(t.source&&t.target){var i,r;const e=this.data.nodes.find((e=>e.id===t.source)),o=this.data.nodes.find((e=>e.id===t.target));return`${null!==(i=null==e?void 0:e.label)&&void 0!==i?i:t.source} â†’ ${null!==(r=null==o?void 0:o.label)&&void 0!==r?r:t.target}<br>${a}`}return null},this._createData=(0,l.Z)(((e,t=0)=>{const a=e.nodes.filter((e=>e.value>0)),o=[...new Set(a.map((e=>e.index)))],i=new Map;o.sort().forEach(((e,t)=>{i.set(e,t)}));const r=this._processLinks(a,e.links),s=t/o.length-u.TB-y;return{id:"sankey",type:"sankey",nodes:a.map((e=>({id:e.id,value:e.value,itemStyle:{color:e.color},depth:i.get(e.index)}))),links:r,draggable:!1,orient:this.vertical?"vertical":"horizontal",nodeWidth:15,nodeGap:b,lineStyle:{color:"gradient",opacity:.4},layoutIterations:0,label:{formatter:t=>{var a,o;return null!==(a=null===(o=e.nodes.find((e=>e.id===t.data.id)))||void 0===o?void 0:o.label)&&void 0!==a?a:t.data.id},position:this.vertical?"bottom":"right",distance:y,minMargin:5,overflow:"break"},labelLayout:e=>{if(this.vertical){const t=e.text.split(" ").reduce(((e,t)=>e.length>t.length?e:t),""),a=(0,d.U)(t,g),o=Math.min(g,e.rect.width/a*g);return{fontSize:o>1?o:0,width:e.rect.width,align:"center"}}const t=Math.ceil(e.labelRect.width/s),a=Math.min(e.rect.height/t*g,g);return{fontSize:a,lineHeight:a,width:s,height:e.rect.height}},top:this.vertical?0:p,bottom:this.vertical?25:p,left:this.vertical?p:0,right:this.vertical?p:s+y,emphasis:{focus:"adjacency"}}}))}}m.styles=(0,r.iv)(f||(f=v`:host{display:block;flex:1;background:var(--ha-card-background,var(--card-background-color))}ha-chart-base{width:100%;height:100%}`)),(0,o.__decorate)([(0,i.Cb)({attribute:!1})],m.prototype,"hass",void 0),(0,o.__decorate)([(0,i.Cb)({attribute:!1})],m.prototype,"data",void 0),(0,o.__decorate)([(0,i.Cb)({type:Boolean})],m.prototype,"vertical",void 0),(0,o.__decorate)([(0,i.Cb)({type:String,attribute:!1})],m.prototype,"valueFormatter",void 0),(0,o.__decorate)([(0,i.SB)()],m.prototype,"_sizeController",void 0),m=(0,o.__decorate)([(0,i.Mo)("ha-sankey-chart")],m),t()}catch(_){t(_)}}))},28996:function(e,t,a){a.d(t,{N_:()=>o,Qs:()=>r,TB:()=>i});const o=10,i=30,r=20},7214:function(e,t,a){a.d(t,{Cj:()=>h,F7:()=>i,Hs:()=>S,Kd:()=>k,Kj:()=>f,Nw:()=>p,PA:()=>r,Py:()=>n,Qm:()=>$,Z0:()=>y,_Y:()=>c,_m:()=>s,dL:()=>d,dO:()=>x,hN:()=>_,h_:()=>u,j2:()=>m,q6:()=>v,uR:()=>l});a(39710),a(26847),a(81738),a(72489),a(56389),a(27530);var o=a(15459),i=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({});const r=99387==a.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,s=e=>e.sendMessagePromise({type:"recorder/info"}),l=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),n=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),d=(e,t,a,o,i="hour",r,s)=>e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:null==a?void 0:a.toISOString(),statistic_ids:o,period:i,units:r,types:s}),c=(e,t,a,o)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:o,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar,rolling_window:a.rolling_window}),u=e=>e.callWS({type:"recorder/validate_statistics"}),h=(e,t,a)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:a}),_=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),f=e=>{let t=null;if(!e)return null;for(const a of e)null!==a.change&&void 0!==a.change&&(null===t?t=a.change:t+=a.change);return t},v=(e,t)=>{let a=null;for(const o of t){if(!(o in e))continue;const t=f(e[o]);null!==t&&(null===a?a=t:a+=t)}return a},p=(e,t)=>e.some((e=>void 0!==e[t]&&null!==e[t])),g=["mean","min","max"],b=["sum","state","change"],y=(e,t)=>!(!g.includes(t)||0===e.mean_type)||!(!b.includes(t)||!e.has_sum),m=(e,t,a,o,i)=>{const r=new Date(a).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:r,adjustment:o,adjustment_unit_of_measurement:i})},k=(e,t,a)=>{const i=e.states[t];return i?(0,o.C)(i):(null==a?void 0:a.name)||t},x=(e,t,a)=>{let o;var i;t&&(o=null===(i=e.states[t])||void 0===i?void 0:i.attributes.unit_of_measurement);return void 0===o?null==a?void 0:a.statistics_unit_of_measurement:o},S=e=>e.includes(":"),$=e=>e.callWS({type:"recorder/update_statistics_issues"})},6291:function(e,t,a){a.d(t,{f:()=>r});a(39710),a(26847),a(81738),a(72489),a(1455),a(56389),a(27530);var o=a(73742),i=a(7616);const r=e=>{class t extends e{connectedCallback(){super.connectedCallback(),this._checkSubscribed()}disconnectedCallback(){if(super.disconnectedCallback(),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}updated(e){if(super.updated(e),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}hassSubscribe(){return[]}_checkSubscribed(){var e;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((e=>void 0===this[e]))||(this.__unsubs=this.hassSubscribe())}}return(0,o.__decorate)([(0,i.Cb)({attribute:!1})],t.prototype,"hass",void 0),t}},8528:function(e,t,a){a.a(e,(async function(e,o){try{a.r(t);a(39710),a(26847),a(2394),a(44438),a(18574),a(73042),a(81738),a(22960),a(93190),a(87799),a(56389),a(27530);var i=a(73742),r=a(59048),s=a(7616),l=(a(31138),a(993),a(6640)),n=a(7214),d=a(6291),c=a(51676),u=a(55815),h=a(28598),_=a(51574),f=e([c,l,h]);[c,l,h]=f.then?(await f)():f;let v,p,g,b,y,m=e=>e;const k={group_by_floor:!0,group_by_area:!0};class x extends((0,d.f)(r.oi)){setConfig(e){this._config=Object.assign(Object.assign({},k),e)}hassSubscribe(){var e;return[(0,l.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((e=>{this._data=e}))]}getCardSize(){return 5}getGridOptions(){return{columns:12,min_columns:6,rows:6,min_rows:2}}shouldUpdate(e){return e.has("_config")||e.has("_data")}render(){if(!this._config)return r.Ld;if(!this._data)return(0,r.dy)(v||(v=m`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));const e=this._data.prefs,t=(0,l.Jj)(e),{summedData:a,compareSummedData:o}=(0,l.EH)(this._data),i=getComputedStyle(this),s=[],d=[],c={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:0,color:i.getPropertyValue("--primary-color"),index:1};if(s.push(c),t.grid){var _;const e=null!==(_=a.total.from_grid)&&void 0!==_?_:0;s.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,tooltip:`${(0,h.uf)(e,this.hass.locale)} kWh`,color:i.getPropertyValue("--energy-grid-consumption-color"),index:0}),d.push({source:"grid",target:"home"})}if(t.solar){var f;const e=null!==(f=a.total.solar)&&void 0!==f?f:0;s.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:e,tooltip:`${(0,h.uf)(e,this.hass.locale)} kWh`,color:i.getPropertyValue("--energy-solar-color"),index:0}),d.push({source:"solar",target:"home"})}if(c.value=s.filter((e=>0===e.index)).reduce(((e,t)=>e+(t.value||0)),0),t.battery){var y,k;const e=(null!==(y=a.total.from_battery)&&void 0!==y?y:0)-(null!==(k=a.total.to_battery)&&void 0!==k?k:0),t=Math.max(e,0),o=Math.max(-e,0);c.value+=e,s.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:t,tooltip:`${(0,h.uf)(t,this.hass.locale)} kWh`,color:i.getPropertyValue("--energy-battery-out-color"),index:0}),d.push({source:"battery",target:"home"}),s.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:o,tooltip:`${(0,h.uf)(o,this.hass.locale)} kWh`,color:i.getPropertyValue("--energy-battery-in-color"),index:1}),s.forEach((e=>{0===e.index&&d.push({source:e.id,target:"battery_in"})}))}if(t.grid&&t.grid[0].flow_to){var x;const e=null!==(x=a.total.to_grid)&&void 0!==x?x:0;s.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,tooltip:`${(0,h.uf)(e,this.hass.locale)} kWh`,color:i.getPropertyValue("--energy-grid-return-color"),index:1}),s.forEach((e=>{0===e.index&&"grid"!==e.id&&d.push({source:e.id,target:"grid_return"})})),c.value-=e}let S=c.value;const $=[];e.device_consumption.forEach(((e,t)=>{const a=e.stat_consumption in this._data.stats&&(0,n.Kj)(this._data.stats[e.stat_consumption])||0;a<.01||(S-=a,$.push({id:e.stat_consumption,label:e.name||(0,n.Kd)(this.hass,e.stat_consumption,this._data.statsMetadata[e.stat_consumption]),value:a,tooltip:`${(0,h.uf)(a,this.hass.locale)} kWh`,color:(0,u.hZ)(t,i),index:4}))}));const{group_by_area:w,group_by_floor:C}=this._config;if(w||C){const{areas:e,floors:t}=this._groupByFloorAndArea($);Object.keys(t).sort(((e,t)=>{var a,o,i,r;return(null!==(a=null===(o=this.hass.floors[t])||void 0===o?void 0:o.level)&&void 0!==a?a:-1/0)-(null!==(i=null===(r=this.hass.floors[e])||void 0===r?void 0:r.level)&&void 0!==i?i:-1/0)})).forEach((a=>{let o=`floor_${a}`;"no_floor"!==a&&C?(s.push({id:o,label:this.hass.floors[a].name,value:t[a].value,tooltip:`${(0,h.uf)(t[a].value,this.hass.locale)} kWh`,index:2,color:i.getPropertyValue("--primary-color")}),d.push({source:"home",target:o})):o="home",t[a].areas.forEach((t=>{let a;if("no_area"!==t&&w){const r=`area_${t}`;s.push({id:r,label:this.hass.areas[t].name,value:e[t].value,tooltip:`${(0,h.uf)(e[t].value,this.hass.locale)} kWh`,index:3,color:i.getPropertyValue("--primary-color")}),d.push({source:o,target:r,value:e[t].value}),a=r}else a=o;e[t].devices.forEach((e=>{s.push(e),d.push({source:a,target:e.id,value:e.value})}))}))}))}else $.forEach((e=>{s.push(e),d.push({source:"home",target:e.id,value:e.value})}));S>0?(s.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:S,tooltip:`${(0,h.uf)(S,this.hass.locale)} kWh`,color:i.getPropertyValue("--state-unavailable-color"),index:4}),d.push({source:"home",target:"untracked",value:S})):S<0&&(c.value-=S),c.tooltip=`${(0,h.uf)(c.value,this.hass.locale)} kWh`;const W=s.some((e=>e.value>0));return(0,r.dy)(p||(p=m` <ha-card .header="${0}"> <div class="card-content"> ${0} </div> </ha-card> `),this._config.title,W?(0,r.dy)(g||(g=m`<ha-sankey-chart .data="${0}" .vertical="${0}" .valueFormatter="${0}"></ha-sankey-chart>`),{nodes:s,links:d},"vertical"===this._config.layout,this._valueFormatter):(0,r.dy)(b||(b=m`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")))}_groupByFloorAndArea(e){const t={no_area:{value:0,devices:[]}},a={no_floor:{value:0,areas:["no_area"]}};return e.forEach((e=>{const o=this.hass.states[e.id],{area:i,floor:r}=(0,_.U)(o,this.hass);i?(i.area_id in t?(t[i.area_id].value+=e.value,t[i.area_id].devices.push(e)):t[i.area_id]={value:e.value,devices:[e]},r?r.floor_id in a?(a[r.floor_id].value+=e.value,a[r.floor_id].areas.includes(i.area_id)||a[r.floor_id].areas.push(i.area_id)):a[r.floor_id]={value:e.value,areas:[i.area_id]}:(a.no_floor.value+=e.value,a.no_floor.areas.includes(i.area_id)||a.no_floor.areas.unshift(i.area_id))):(t.no_area.value+=e.value,t.no_area.devices.push(e))})),{areas:t,floors:a}}constructor(...e){super(...e),this.hassSubscribeRequiredHostProps=["_config"],this._valueFormatter=e=>`${(0,h.uf)(e,this.hass.locale)} kWh`}}x.styles=(0,r.iv)(y||(y=m`:host{display:block;height:calc(var(--row-size,8) * (var(--row-height,50px) + var(--row-gap,0px)) - var(--row-gap,0px))}ha-card{height:100%;display:flex;flex-direction:column}.card-content{flex:1;display:flex}`)),(0,i.__decorate)([(0,s.Cb)({attribute:!1})],x.prototype,"hass",void 0),(0,i.__decorate)([(0,s.SB)()],x.prototype,"_config",void 0),(0,i.__decorate)([(0,s.SB)()],x.prototype,"_data",void 0),x=(0,i.__decorate)([(0,s.Mo)("hui-energy-sankey-card")],x),o()}catch(v){o(v)}}))},3901:function(e,t,a){let o;function i(e,t,a="Roboto, Noto, sans-serif"){o||(o=document.createElement("canvas"));const i=o.getContext("2d");if(!i)return 0;i.font=`${t}px ${a}`;const r=i.measureText(e);return Math.ceil(Math.max(r.actualBoundingBoxRight+r.actualBoundingBoxLeft,r.width))}a.d(t,{U:()=>i})}}]);
//# sourceMappingURL=40908.dc954033586756bf.js.map