/*! For license information please see 931.e4e25be660497686f666.js.LICENSE.txt */
"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[312,931],{3931:(t,e,s)=>{s.r(e),s.d(e,{Aliases:()=>i.D,BaseShell:()=>u,BaseShellWorker:()=>_.g,BufferedOutput:()=>p.j,ConsoleOutput:()=>g,ControlCharacter:()=>N.hE,ExitCode:()=>f.y,FileInput:()=>C.z,FileOutput:()=>m.M,InputAll:()=>E.S,InputFlag:()=>N.tc,JavaScriptInput:()=>y._,LocalFlag:()=>N.Uq,OutputFlag:()=>N.OJ,Pipe:()=>I.n,PipeInput:()=>O.J,RedirectOutput:()=>S,Shell:()=>b,TerminalInput:()=>A.d,TerminalOutput:()=>w.m,Termios:()=>N.Gc,parse:()=>T.qg,tokenize:()=>k.q});var i=s(7450),a=s(7262),r=s(4602),n=s(9017);class o{constructor(){}async disable(){this._enabled=!1,this._clear()}dispose(){this._isDisposed||(this._isDisposed=!0)}async enable(){this._enabled=!0}get enabled(){return this._enabled}get isDisposed(){return this._isDisposed}registerSendStdinNow(t){this._sendStdinNow=t}_disabling=!1;_enabled=!1;_isDisposed=!1;_sendStdinNow}var l=s(763);class c extends o{constructor(){super();const t=Int32Array.BYTES_PER_ELEMENT,e=l.X.maxChars+3;this._sharedArrayBuffer=new SharedArrayBuffer(e*t),this._intArray=new Int32Array(this._sharedArrayBuffer,0,e),this._intArray[l.X.MAIN]=0,this._intArray[l.X.WORKER]=0}async disable(){if(this._disabling=!0,this._readSentCount!==this._readCount){const t=this._loadFromSharedArrayBuffer();let e="";for(const s of t)e+=String.fromCharCode(s);this._sendStdinNow(e)}for(;this._readBuffer.length>0;)this._sendStdinNow(this._readBuffer.shift());await super.disable(),this._disabling=!1}get sharedArrayBuffer(){return this._sharedArrayBuffer}async push(t){t.length>l.X.maxChars&&console.log(`String '${t}' is too long to buffer`),this._readBuffer.push(t),this._readBufferCount++,this._disabling||this._readCount!==this._readSentCount||this._storeInSharedArrayBuffer()}_afterRead(){this._readCount=Atomics.load(this._intArray,1),this._readCount===this._readSentCount&&this._readBufferCount>this._readSentCount&&this._storeInSharedArrayBuffer()}_clear(){this._intArray[l.X.MAIN]=0,this._intArray[l.X.WORKER]=0,this._readCount=0,this._readBuffer=[],this._readBufferCount=0,this._readSentCount=0}_loadFromSharedArrayBuffer(){const t=Atomics.load(this._intArray,l.X.LENGTH),e=[];for(let s=0;s<t;s++)e.push(Atomics.load(this._intArray,l.X.START+s));return e}_storeInSharedArrayBuffer(){const t=this._readBuffer.shift();this._readSentCount++;const e=t.length;Atomics.store(this._intArray,l.X.LENGTH,e);for(let s=0;s<e;s++)Atomics.store(this._intArray,l.X.START+s,t.charCodeAt(s));Atomics.store(this._intArray,l.X.MAIN,this._readSentCount),Atomics.notify(this._intArray,l.X.MAIN,1);const{async:s,value:i}=Atomics.waitAsync(this._intArray,l.X.WORKER,this._readCount);s?i.then((()=>this._afterRead())):this._afterRead()}_intArray;_readBuffer=[];_readBufferCount=0;_readCount=0;_readSentCount=0;_sharedArrayBuffer}var h=s(9399);class d{packageName;moduleName;outputCallback;constructor(t,e,s){this.packageName=t,this.moduleName=e,this.outputCallback=s}dispose(){this._isDisposed||(this.stop(),this._isDisposed=!0)}get isDisposed(){return this._isDisposed}start(){void 0!==this._intervalId&&this.stop(),this._intervalId=setInterval(this._callback.bind(this),this._delayMs)}stop(){void 0!==this._intervalId&&(clearTimeout(this._intervalId),this._intervalId=void 0,this._callbackCount=0,this._displayed&&this.outputCallback(h.Q.eraseEndLine+h.Q.showCursor),this._displayed=!1)}_callback(){if(this._callbackCount<this._initialIgnore);else if(this._displayed){const t=this._dots[(this._callbackCount-this._initialIgnore)%this._dots.length];this.outputCallback(t+h.Q.cursorLeft(1))}else{const t=` downloading wasm module '${this.moduleName}'`,e=t.length;this.outputCallback(h.Q.hideCursor+this._dots[0]+t+h.Q.cursorLeft(e+1)),this._displayed=!0}this._callbackCount++}_callbackCount=0;_delayMs=100;_dots="⠇⠋⠙⠸⠴⠦";_initialIgnore=3;_intervalId;_isDisposed=!1;_displayed=!1}class u{options;constructor(t){this.options=t,this._mainIO=new c,this._worker=this.initWorker(t),this._initRemote(t).then(this._ready.resolve.bind(this._ready))}async _initRemote(t){this._remote=(0,n.LV)(this._worker);const{mountpoint:e,wasmBaseUrl:s,driveFsBaseUrl:i,browsingContextId:a,initialDirectories:r,initialFiles:o}=t,{sharedArrayBuffer:l}=this._mainIO;await this._remote.initialize({color:t.color??!0,mountpoint:e,wasmBaseUrl:s,driveFsBaseUrl:i,browsingContextId:a,sharedArrayBuffer:l,initialDirectories:r,initialFiles:o},(0,n.BX)(this.downloadWasmModuleCallback.bind(this)),(0,n.BX)(this.enableBufferedStdinCallback.bind(this)),(0,n.BX)(t.outputCallback),(0,n.BX)(this.dispose.bind(this))),this._mainIO.registerSendStdinNow(this._remote.input)}dispose(){this._isDisposed||(console.log("Cockle Shell disposed"),this._isDisposed=!0,this._remote=void 0,this._worker.terminate(),void 0!==this._downloadTracker&&(this._downloadTracker.dispose(),this._downloadTracker=void 0),this._mainIO.dispose(),this._mainIO=void 0,this._disposed.emit())}get disposed(){return this._disposed}downloadWasmModuleCallback(t,e,s){s?(void 0!==this._downloadTracker&&this._downloadTracker.dispose(),this._downloadTracker=new d(t,e,this.options.outputCallback),this._downloadTracker.start()):void 0!==this._downloadTracker&&t===this._downloadTracker.packageName&&e===this._downloadTracker.moduleName&&this._downloadTracker.stop()}get isDisposed(){return this._isDisposed}async enableBufferedStdinCallback(t){this.isDisposed||(t?await this._mainIO.enable():await this._mainIO.disable())}async input(t){this.isDisposed||(this._mainIO.enabled?await this._mainIO.push(t):await this._remote.input(t))}get ready(){return this._ready.promise}async setSize(t,e){this.isDisposed||await this._remote.setSize(t,e)}async start(){this.isDisposed||(await this.ready,await this._remote.start())}_disposed=new r.Signal(this);_isDisposed=!1;_ready=new a.PromiseDelegate;_worker;_remote;_mainIO;_downloadTracker}var _=s(9488),f=s(3482),p=s(5670);class g{flush(){}supportsAnsiEscapes(){return!1}write(t){console.log(t)}}var C=s(2958),m=s(5981),E=s(1315),y=s(1203),I=s(4207),O=s(952);class S extends p.j{constructor(t){super(),this.target=t}flush(){this.data.forEach((t=>this.target.write(t))),this.clear(),this.target.flush()}target}var A=s(8316),w=s(7703),T=s(7497);class b extends u{options;constructor(t){super(t),this.options=t}initWorker(t){return console.log("Cockle Shell.initWorker"),new Worker(new URL(s.p+s.u(148),s.b),{type:void 0})}}var N=s(4133),k=s(9685)},4133:(t,e,s)=>{var i,a,r,n;s.d(e,{Gc:()=>o,OJ:()=>a,Uq:()=>r,hE:()=>n,tc:()=>i}),function(t){t[t.ISTRIP=32]="ISTRIP",t[t.INLCR=64]="INLCR",t[t.IGNCR=128]="IGNCR",t[t.ICRNL=256]="ICRNL",t[t.IUCLC=512]="IUCLC",t[t.IXON=1024]="IXON",t[t.IXANY=2048]="IXANY",t[t.IMAXBEL=8192]="IMAXBEL",t[t.IUTF8=16384]="IUTF8"}(i||(i={})),function(t){t[t.OPOST=1]="OPOST",t[t.OLCUC=2]="OLCUC",t[t.ONLCR=4]="ONLCR",t[t.OCRNL=8]="OCRNL",t[t.ONOCR=16]="ONOCR",t[t.ONLRET=32]="ONLRET",t[t.TABDLY=6144]="TABDLY"}(a||(a={})),function(t){t[t.ISIG=1]="ISIG",t[t.ICANON=2]="ICANON",t[t.ECHO=8]="ECHO",t[t.ECHOE=16]="ECHOE",t[t.ECHOK=32]="ECHOK",t[t.ECHONL=64]="ECHONL",t[t.NOFLSH=128]="NOFLSH",t[t.ECHOCTL=512]="ECHOCTL",t[t.ECHOPRT=1024]="ECHOPRT",t[t.ECHOKE=2048]="ECHOKE",t[t.IEXTEN=32768]="IEXTEN"}(r||(r={})),function(t){t[t.VINTR=0]="VINTR",t[t.VQUIT=1]="VQUIT",t[t.VERASE=2]="VERASE",t[t.VKILL=3]="VKILL",t[t.VEOF=4]="VEOF",t[t.VTIME=5]="VTIME",t[t.VMIN=6]="VMIN",t[t.VSWTCH=7]="VSWTCH",t[t.VSTART=8]="VSTART",t[t.VSTOP=9]="VSTOP",t[t.VSUSP=10]="VSUSP",t[t.VEOL=11]="VEOL",t[t.VREPRINT=12]="VREPRINT",t[t.VDISCARD=13]="VDISCARD",t[t.VWERASE=14]="VWERASE",t[t.VLNEXT=15]="VLNEXT",t[t.VEOL2=16]="VEOL2"}(n||(n={}));class o{clone(){return{c_iflag:this.c_iflag,c_oflag:this.c_oflag,c_cflag:this.c_cflag,c_lflag:this.c_lflag,c_cc:[...this.c_cc]}}log(t){const e=(t,e,s)=>{const i=[];for(const[e,a]of Object.entries(t).filter((([t,e])=>t[0].match(/\D/))))(s&a)>0&&i.push(e);return`  ${e} = ${s} 0x${s.toString(16)} = ${i.join(" ")}`},s=["Cockle "+t+":"];s.push(e(i,"c_iflag",this.c_iflag)),s.push(e(a,"c_oflag",this.c_oflag)),s.push(`  c_cflag = ${this.c_cflag} 0x${this.c_cflag.toString(16)}`),s.push(e(r,"c_lflag",this.c_lflag)),s.push(`  c_cc = ${this.c_cc}`),console.log(s.join("\n"))}static newDefaultWasm(){const t=new o;return t.setDefaultWasm(),t}set(t){this.c_iflag=t.c_iflag,this.c_oflag=t.c_oflag,this.c_cflag=t.c_cflag,this.c_lflag=t.c_lflag,this.c_cc=[...t.c_cc],this.log("Termios set")}setDefaultWasm(){this.c_iflag=i.IUTF8|i.IMAXBEL|i.IXON|i.ICRNL,this.c_oflag=a.OPOST|a.ONLCR,this.c_cflag=191,this.c_lflag=r.IEXTEN|r.ECHOKE|r.ECHOCTL|r.ECHOK|r.ECHOE|r.ECHO|r.ICANON|r.ISIG,this.c_cc=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.log("Termios setDefaultWasm")}c_iflag=0;c_oflag=0;c_cflag=0;c_lflag=0;c_cc=[]}},9017:(t,e,s)=>{s.d(e,{BX:()=>y,LV:()=>u,p:()=>h});const i=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),n=Symbol("Comlink.finalizer"),o=Symbol("Comlink.thrown"),l=t=>"object"==typeof t&&null!==t||"function"==typeof t,c=new Map([["proxy",{canHandle:t=>l(t)&&t[i],serialize(t){const{port1:e,port2:s}=new MessageChannel;return h(t,e),[s,[s]]},deserialize:t=>(t.start(),u(t))}],["throw",{canHandle:t=>l(t)&&o in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function h(t,e=globalThis,s=["*"]){e.addEventListener("message",(function i(a){if(!a||!a.data)return;if(!function(t,e){for(const s of t){if(e===s||"*"===s)return!0;if(s instanceof RegExp&&s.test(e))return!0}return!1}(s,a.origin))return void console.warn(`Invalid origin '${a.origin}' for comlink proxy`);const{id:r,type:l,path:c}=Object.assign({path:[]},a.data),u=(a.data.argumentList||[]).map(O);let _;try{const e=c.slice(0,-1).reduce(((t,e)=>t[e]),t),s=c.reduce(((t,e)=>t[e]),t);switch(l){case"GET":_=s;break;case"SET":e[c.slice(-1)[0]]=O(a.data.value),_=!0;break;case"APPLY":_=s.apply(e,u);break;case"CONSTRUCT":_=y(new s(...u));break;case"ENDPOINT":{const{port1:e,port2:s}=new MessageChannel;h(t,s),_=function(t,e){return E.set(t,e),t}(e,[e])}break;case"RELEASE":_=void 0;break;default:return}}catch(t){_={value:t,[o]:0}}Promise.resolve(_).catch((t=>({value:t,[o]:0}))).then((s=>{const[a,o]=I(s);e.postMessage(Object.assign(Object.assign({},a),{id:r}),o),"RELEASE"===l&&(e.removeEventListener("message",i),d(e),n in t&&"function"==typeof t[n]&&t[n]())})).catch((t=>{const[s,i]=I({value:new TypeError("Unserializable return value"),[o]:0});e.postMessage(Object.assign(Object.assign({},s),{id:r}),i)}))})),e.start&&e.start()}function d(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function u(t,e){const s=new Map;return t.addEventListener("message",(function(t){const{data:e}=t;if(!e||!e.id)return;const i=s.get(e.id);if(i)try{i(e)}finally{s.delete(e.id)}})),C(t,s,[],e)}function _(t){if(t)throw new Error("Proxy has been released and is not useable")}function f(t){return S(t,new Map,{type:"RELEASE"}).then((()=>{d(t)}))}const p=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(p.get(t)||0)-1;p.set(t,e),0===e&&f(t)}));function C(t,e,s=[],i=function(){}){let n=!1;const o=new Proxy(i,{get(i,a){if(_(n),a===r)return()=>{!function(t){g&&g.unregister(t)}(o),f(t),e.clear(),n=!0};if("then"===a){if(0===s.length)return{then:()=>o};const i=S(t,e,{type:"GET",path:s.map((t=>t.toString()))}).then(O);return i.then.bind(i)}return C(t,e,[...s,a])},set(i,a,r){_(n);const[o,l]=I(r);return S(t,e,{type:"SET",path:[...s,a].map((t=>t.toString())),value:o},l).then(O)},apply(i,r,o){_(n);const l=s[s.length-1];if(l===a)return S(t,e,{type:"ENDPOINT"}).then(O);if("bind"===l)return C(t,e,s.slice(0,-1));const[c,h]=m(o);return S(t,e,{type:"APPLY",path:s.map((t=>t.toString())),argumentList:c},h).then(O)},construct(i,a){_(n);const[r,o]=m(a);return S(t,e,{type:"CONSTRUCT",path:s.map((t=>t.toString())),argumentList:r},o).then(O)}});return function(t,e){const s=(p.get(e)||0)+1;p.set(e,s),g&&g.register(t,e,t)}(o,t),o}function m(t){const e=t.map(I);return[e.map((t=>t[0])),(s=e.map((t=>t[1])),Array.prototype.concat.apply([],s))];var s}const E=new WeakMap;function y(t){return Object.assign(t,{[i]:!0})}function I(t){for(const[e,s]of c)if(s.canHandle(t)){const[i,a]=s.serialize(t);return[{type:"HANDLER",name:e,value:i},a]}return[{type:"RAW",value:t},E.get(t)||[]]}function O(t){switch(t.type){case"HANDLER":return c.get(t.name).deserialize(t.value);case"RAW":return t.value}}function S(t,e,s,i){return new Promise((a=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.set(r,a),t.start&&t.start(),t.postMessage(Object.assign({id:r},s),i)}))}}}]);